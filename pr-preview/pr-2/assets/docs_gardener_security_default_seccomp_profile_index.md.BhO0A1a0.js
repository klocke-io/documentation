import{_ as t,c as s,o as a,a2 as i}from"./chunks/framework.B8WFj13S.js";const u=JSON.parse('{"title":"Default Seccomp Profile","description":"Enable the use of `RuntimeDefault` as the default seccomp profile through `spec.kubernetes.kubelet.seccompDefault`","frontmatter":{"aliases":["/docs/gardener/default_seccomp_profile/"],"description":"Enable the use of `RuntimeDefault` as the default seccomp profile through `spec.kubernetes.kubelet.seccompDefault`","github_repo":"https://github.com/gardener/gardener","github_subdir":"docs/usage/security","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/gardener/security/default_seccomp_profile.md","to":"default_seccomp_profile.md"},"persona":"Users","title":"Default Seccomp Profile","prev":false,"next":false},"headers":[],"relativePath":"docs/gardener/security/default_seccomp_profile/index.md","filePath":"docs/gardener/security/default_seccomp_profile.md","lastUpdated":null}'),o={name:"docs/gardener/security/default_seccomp_profile/index.md"};function l(n,e,r,c,p,d){return a(),s("div",null,e[0]||(e[0]=[i(`<h1 id="default-seccomp-profile-and-configuration" tabindex="-1">Default Seccomp Profile and Configuration <a class="header-anchor" href="#default-seccomp-profile-and-configuration" aria-label="Permalink to &quot;Default Seccomp Profile and Configuration&quot;">​</a></h1><p>This is a short guide describing how to enable the defaulting of seccomp profiles for Gardener managed workloads in the seed. Running pods in <code>Unconfined</code> (seccomp disabled) mode is undesirable since this is the least restrictive profile. Also, mind that any privileged container will always run as <code>Unconfined</code>. More information about seccomp can be found in this <a href="https://kubernetes.io/docs/tutorials/security/seccomp/" target="_blank" rel="noreferrer">Kubernetes tutorial</a>.</p><h2 id="setting-the-seccomp-profile-to-runtimedefault-for-seed-clusters" tabindex="-1">Setting the Seccomp Profile to RuntimeDefault for Seed Clusters <a class="header-anchor" href="#setting-the-seccomp-profile-to-runtimedefault-for-seed-clusters" aria-label="Permalink to &quot;Setting the Seccomp Profile to RuntimeDefault for Seed Clusters&quot;">​</a></h2><p>To address the above issue, Gardener provides a webhook that is capable of mutating pods in the seed clusters, explicitly providing them with a seccomp profile type of <code>RuntimeDefault</code>. This profile is defined by the container runtime and represents a set of default syscalls that are allowed or not.</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  securityContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    seccompProfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">RuntimeDefault</span></span></code></pre></div><p>A <code>Pod</code> is mutated when all of the following preconditions are fulfilled:</p><ol><li>The <code>Pod</code> is created in a Gardener managed namespace.</li><li>The <code>Pod</code> is NOT labeled with <code>seccompprofile.resources.gardener.cloud/skip</code>.</li><li>The <code>Pod</code> does NOT explicitly specify <code>.spec.securityContext.seccompProfile.type</code>.</li></ol><h3 id="how-to-configure" tabindex="-1">How to Configure <a class="header-anchor" href="#how-to-configure" aria-label="Permalink to &quot;How to Configure&quot;">​</a></h3><p>To enable this feature, the gardenlet <code>DefaultSeccompProfile</code> feature gate must be set to <code>true</code>.</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">featureGates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  DefaultSeccompProfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></div><p>Please refer to the examples in this <a href="https://github.com/gardener/gardener/blob/master/example/20-componentconfig-gardenlet.yaml" target="_blank" rel="noreferrer">yaml file</a> for more information.</p><p>Once the feature gate is enabled, the webhook will be registered and configured for the seed cluster. Newly created pods will be mutated to have their seccomp profile set to <code>RuntimeDefault</code>.</p><blockquote><p><strong>Note:</strong> Please note that this feature is still in Alpha, so you might see instabilities every now and then.</p></blockquote><h2 id="setting-the-seccomp-profile-to-runtimedefault-for-shoot-clusters" tabindex="-1">Setting the Seccomp Profile to RuntimeDefault for Shoot Clusters <a class="header-anchor" href="#setting-the-seccomp-profile-to-runtimedefault-for-shoot-clusters" aria-label="Permalink to &quot;Setting the Seccomp Profile to RuntimeDefault for Shoot Clusters&quot;">​</a></h2><p>You can enable the use of <code>RuntimeDefault</code> as the default seccomp profile for all workloads. If enabled, the kubelet will use the <code>RuntimeDefault</code> seccomp profile by default, which is defined by the container runtime, instead of using the <code>Unconfined</code> mode. More information for this feature can be found in the <a href="https://kubernetes.io/docs/tutorials/security/seccomp/#enable-the-use-of-runtimedefault-as-the-default-seccomp-profile-for-all-workloads" target="_blank" rel="noreferrer">Kubernetes documentation</a>.</p><p>To use seccomp profile defaulting, you must run the kubelet with the <code>SeccompDefault</code> feature gate enabled (this is the default).</p><h3 id="how-to-configure-1" tabindex="-1">How to Configure <a class="header-anchor" href="#how-to-configure-1" aria-label="Permalink to &quot;How to Configure&quot;">​</a></h3><p>To enable this feature, the kubelet <code>seccompDefault</code> configuration parameter must be set to <code>true</code> in the shoot&#39;s spec.</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  kubernetes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.25.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    kubelet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      seccompDefault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></div><p>Please refer to the examples in this <a href="https://github.com/gardener/gardener/blob/master/example/90-shoot.yaml" target="_blank" rel="noreferrer">yaml file</a> for more information.</p>`,20)]))}const f=t(o,[["render",l]]);export{u as __pageData,f as default};
