import{_ as s,c as a,o as t,a2 as i}from"./chunks/framework.Bfq10Vlj.js";const r="/assets/getting_started_locally_with_extensions.CghTeUs8.png",g=JSON.parse('{"title":"Getting Started Locally With Extensions","description":"","frontmatter":{"github_repo":"https://github.com/gardener/gardener","github_subdir":"docs/deployment","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/gardener/deployment/getting_started_locally_with_extensions.md","to":"getting_started_locally_with_extensions.md"},"title":"Getting Started Locally With Extensions","prev":false,"next":false},"headers":[],"relativePath":"docs/gardener/deployment/getting_started_locally_with_extensions/index.md","filePath":"docs/gardener/deployment/getting_started_locally_with_extensions.md","lastUpdated":null}'),n={name:"docs/gardener/deployment/getting_started_locally_with_extensions/index.md"};function o(l,e,d,h,c,p){return t(),a("div",null,e[0]||(e[0]=[i('<h1 id="deploying-gardener-locally-and-enabling-provider-extensions" tabindex="-1">Deploying Gardener Locally and Enabling Provider-Extensions <a class="header-anchor" href="#deploying-gardener-locally-and-enabling-provider-extensions" aria-label="Permalink to &quot;Deploying Gardener Locally and Enabling Provider-Extensions&quot;">​</a></h1><p>This document will walk you through deploying Gardener on your local machine and bootstrapping your own seed clusters on an existing Kubernetes cluster. It is supposed to run your local Gardener developments on a real infrastructure. For running Gardener only entirely local, please check the <a href="/docs/gardener/deployment/getting_started_locally/">getting started locally</a> documentation. If you encounter difficulties, please open an issue so that we can make this process easier.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>Gardener runs in any Kubernetes cluster. In this guide, we will start a <a href="https://kind.sigs.k8s.io/" target="_blank" rel="noreferrer">KinD</a> cluster which is used as garden cluster. Any Kubernetes cluster could be used as seed clusters in order to support provider extensions (please refer to the <a href="/docs/gardener/concepts/architecture/">architecture overview</a>). This guide is tested for using Kubernetes clusters provided by Gardener, AWS, Azure, and GCP as seed so far.</p><p>Based on <a href="https://skaffold.dev/" target="_blank" rel="noreferrer">Skaffold</a>, the container images for all required components will be built and deployed into the clusters (via their <a href="https://helm.sh/" target="_blank" rel="noreferrer">Helm charts</a>).</p><p><img src="'+r+'" alt="Architecture Diagram"></p><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">​</a></h2><ul><li>Make sure that you have followed the <a href="/docs/gardener/local_setup/">Local Setup guide</a> up until the <a href="/docs/gardener/local_setup/#get-the-sources">Get the sources</a> step.</li><li>Make sure your Docker daemon is up-to-date, up and running and has enough resources (at least <code>8</code> CPUs and <code>8Gi</code> memory; see the <a href="https://docs.docker.com/desktop/settings/mac/" target="_blank" rel="noreferrer">Docker documentation</a> for how to configure the resources for Docker for Mac). <blockquote><p>Additionally, please configure at least <code>120Gi</code> of disk size for the Docker daemon. Tip: You can clean up unused data with <code>docker system df</code> and <code>docker system prune -a</code>.</p></blockquote></li><li>Make sure that you have access to a Kubernetes cluster you can use as a seed cluster in this setup. <ul><li>The seed cluster requires at least 16 CPUs in total to run one shoot cluster</li><li>You could use any Kubernetes cluster for your seed cluster. However, using a Gardener shoot cluster for your seed simplifies some configuration steps.</li><li>When bootstrapping <code>gardenlet</code> to the cluster, your new seed will have the same provider type as the shoot cluster you use - an AWS shoot will become an AWS seed, a GCP shoot will become a GCP seed, etc. (only relevant when using a Gardener shoot as seed).</li></ul></li></ul><h2 id="provide-infrastructure-credentials-and-configuration" tabindex="-1">Provide Infrastructure Credentials and Configuration <a class="header-anchor" href="#provide-infrastructure-credentials-and-configuration" aria-label="Permalink to &quot;Provide Infrastructure Credentials and Configuration&quot;">​</a></h2><p>As this setup is running on a real infrastructure, you have to provide credentials for DNS, the infrastructure, and the kubeconfig for the Kubernetes cluster you want to use as seed.</p><blockquote><p>There are <code>.gitignore</code> entries for all files and directories which include credentials. Nevertheless, please double check and make sure that credentials are not committed to the version control system.</p></blockquote><h3 id="dns" tabindex="-1">DNS <a class="header-anchor" href="#dns" aria-label="Permalink to &quot;DNS&quot;">​</a></h3><p>Gardener control plane requires DNS for default and internal domains. Thus, you have to configure a valid DNS provider for your setup.</p><p>Please maintain your DNS provider configuration and credentials at <a href="https://github.com/gardener/gardener/blob/master/example/provider-extensions/garden/controlplane/domain-secrets.yaml" target="_blank" rel="noreferrer"><code>/example/provider-extensions/garden/controlplane/domain-secrets.yaml</code></a>.</p><p>You can find a template for the file at <a href="https://github.com/gardener/gardener/blob/master/example/provider-extensions/garden/controlplane/domain-secrets.yaml.tmpl" target="_blank" rel="noreferrer"><code>/example/provider-extensions/garden/controlplane/domain-secrets.yaml.tmpl</code></a>.</p><h3 id="infrastructure" tabindex="-1">Infrastructure <a class="header-anchor" href="#infrastructure" aria-label="Permalink to &quot;Infrastructure&quot;">​</a></h3><p>In case infrastructure credentials based on workload identities are used, <code>WorkloadIdentity</code>s and the corresponding <code>CredentialsBinding</code>s should be maintained at:</p><ul><li><a href="https://github.com/gardener/gardener/blob/master/example/provider-extensions/garden/project/with-workload-identity/credentials/infrastructure-workloadidentities.yaml" target="_blank" rel="noreferrer"><code>/example/provider-extensions/garden/project/with-workload-identity/credentials/infrastructure-workloadidentities.yaml</code></a></li><li><a href="https://github.com/gardener/gardener/blob/master/example/provider-extensions/garden/project/with-workload-identity/credentials/credentialsbindings.yaml" target="_blank" rel="noreferrer"><code>/example/provider-extensions/garden/project/with-workload-identity/credentials/credentialsbindings.yaml</code></a></li></ul><p>If static credentials are used, the <code>Secret</code>s and the corresponding <code>CredentialsBinding</code>s that reference the <code>Secret</code>s should be maintained at:</p><ul><li><a href="https://github.com/gardener/gardener/blob/master/example/provider-extensions/garden/project/without-workload-identity/credentials/infrastructure-secrets.yaml" target="_blank" rel="noreferrer"><code>/example/provider-extensions/garden/project/without-workload-identity/credentials/infrastructure-secrets.yaml</code></a></li><li><a href="https://github.com/gardener/gardener/blob/master/example/provider-extensions/garden/project/without-workload-identity/credentials/credentialsbindings.yaml" target="_blank" rel="noreferrer"><code>/example/provider-extensions/garden/project/without-workload-identity/credentials/credentialsbindings.yaml</code></a></li></ul><p>There are templates with <code>.tmpl</code> suffixes for the files in the corresponding folders.</p><h3 id="projects" tabindex="-1">Projects <a class="header-anchor" href="#projects" aria-label="Permalink to &quot;Projects&quot;">​</a></h3><p>The projects and the namespaces associated with them should be maintained at <a href="https://github.com/gardener/gardener/blob/master/example/provider-extensions/garden/project/base/project.yaml" target="_blank" rel="noreferrer"><code>/example/provider-extensions/garden/project/base/project.yaml</code></a>.</p><p>You can find a template for the file at <a href="https://github.com/gardener/gardener/blob/master/example/provider-extensions/garden/project/base/project.yaml.tmpl" target="_blank" rel="noreferrer"><code>/example/provider-extensions/garden/project/base/project.yaml.tmpl</code></a>.</p><h3 id="seed-cluster-preparation" tabindex="-1">Seed Cluster Preparation <a class="header-anchor" href="#seed-cluster-preparation" aria-label="Permalink to &quot;Seed Cluster Preparation&quot;">​</a></h3><p>The <code>kubeconfig</code> of your Kubernetes cluster you would like to use as seed should be placed at <a href="https://github.com/gardener/gardener/blob/master/example/provider-extensions/seed/kubeconfig" target="_blank" rel="noreferrer"><code>/example/provider-extensions/seed/kubeconfig</code></a>. Additionally, please maintain the configuration of your seed in <a href="https://github.com/gardener/gardener/blob/master/example/provider-extensions/gardenlet/values.yaml" target="_blank" rel="noreferrer"><code>/example/provider-extensions/gardenlet/values.yaml</code></a>. It is automatically copied from <code>values.yaml.tmpl</code> in the same directory when you run <code>make gardener-extensions-up</code> for the first time. It also includes explanations of the properties you should set.</p><p>Using a Gardener Shoot cluster as seed simplifies the process, because some configuration options can be taken from <code>shoot-info</code> and creating DNS entries and TLS certificates is automated.</p><p>However, you can use different Kubernetes clusters for your seed too and configure these things manually. Please configure the options of <a href="https://github.com/gardener/gardener/blob/master/example/provider-extensions/gardenlet/values.yaml" target="_blank" rel="noreferrer"><code>/example/provider-extensions/gardenlet/values.yaml</code></a> upfront. For configuring DNS and TLS certificates, <code>make gardener-extensions-up</code>, which is explained later, will pause and tell you what to do.</p><h3 id="external-controllers" tabindex="-1">External Controllers <a class="header-anchor" href="#external-controllers" aria-label="Permalink to &quot;External Controllers&quot;">​</a></h3><p>You might plan to deploy and register external controllers for networking, operating system, providers, etc. Please put <code>ControllerDeployment</code>s and <code>ControllerRegistration</code>s into the <a href="https://github.com/gardener/gardener/tree/master/example/provider-extensions/garden/controllerregistrations" target="_blank" rel="noreferrer"><code>/example/provider-extensions/garden/controllerregistrations</code></a> directory. The whole content of this folder will be applied to your Garden cluster.</p><h3 id="cloudprofiles" tabindex="-1"><code>CloudProfile</code>s <a class="header-anchor" href="#cloudprofiles" aria-label="Permalink to &quot;`CloudProfile`s&quot;">​</a></h3><p>There are no demo <code>CloudProfiles</code> yet. Thus, please copy <code>CloudProfiles</code> from another landscape to the <a href="https://github.com/gardener/gardener/tree/master/example/provider-extensions/garden/cloudprofiles" target="_blank" rel="noreferrer"><code>/example/provider-extensions/garden/cloudprofiles</code></a> directory or create your own <code>CloudProfiles</code> based on the <a href="https://github.com/gardener/gardener/blob/master/example/30-cloudprofile.yaml" target="_blank" rel="noreferrer">gardener examples</a>. Please check the GitHub repository of your desired provider-extension. Most of them include example <code>CloudProfile</code>s. All files you place in this folder will be applied to your Garden cluster.</p><h2 id="setting-up-the-kind-cluster" tabindex="-1">Setting Up the KinD Cluster <a class="header-anchor" href="#setting-up-the-kind-cluster" aria-label="Permalink to &quot;Setting Up the KinD Cluster&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-extensions-up</span></span></code></pre></div><p>This command sets up a new KinD cluster named <code>gardener-extensions</code> and stores the kubeconfig in the <a href="https://github.com/gardener/gardener/blob/master/example/gardener-local/kind/extensions/kubeconfig" target="_blank" rel="noreferrer"><code>/example/gardener-local/kind/extensions/kubeconfig</code></a> file.</p><blockquote><p>It might be helpful to copy this file to <code>$HOME/.kube/config</code>, since you will need to target this KinD cluster multiple times. Alternatively, make sure to set your <code>KUBECONFIG</code> environment variable to <a href="https://github.com/gardener/gardener/blob/master/example/gardener-local/kind/extensions/kubeconfig" target="_blank" rel="noreferrer"><code>/example/gardener-local/kind/extensions/kubeconfig</code></a> for all future steps via <code>export KUBECONFIG=$PWD/example/gardener-local/kind/extensions/kubeconfig</code>.</p></blockquote><p>All of the following steps assume that you are using this kubeconfig.</p><p>Additionally, this command deploys a local container registry to the cluster as well as a few registry mirrors that are set up as a pull-through cache for all upstream registries Gardener uses by default. This is done to speed up image pulls across local clusters.</p><blockquote><p>You will need to add <code>127.0.0.1 garden.local.gardener.cloud</code> to your /etc/hosts.</p></blockquote><p>The local registry can now be accessed either via <code>localhost:5001</code> or <code>garden.local.gardener.cloud:5001</code> for pushing and pulling. The storage directories of the registries are mounted to your machine under <code>dev/local-registry</code>. With this, mirrored images don&#39;t have to be pulled again after recreating the cluster.</p><p>The command also deploys a default <a href="https://github.com/projectcalico/calico" target="_blank" rel="noreferrer">calico</a> installation as the cluster&#39;s CNI implementation with <code>NetworkPolicy</code> support (the default <code>kindnet</code> CNI doesn&#39;t provide <code>NetworkPolicy</code> support). Furthermore, it deploys the <a href="https://github.com/kubernetes-sigs/metrics-server" target="_blank" rel="noreferrer">metrics-server</a> in order to support HPA and VPA on the seed cluster.</p><h2 id="setting-up-gardener-garden-on-kind-seed-on-gardener-cluster" tabindex="-1">Setting Up Gardener (Garden on KinD, Seed on Gardener Cluster) <a class="header-anchor" href="#setting-up-gardener-garden-on-kind-seed-on-gardener-cluster" aria-label="Permalink to &quot;Setting Up Gardener (Garden on KinD, Seed on Gardener Cluster)&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardener-extensions-up</span></span></code></pre></div><p>This will first prepare the basic configuration of your KinD and Gardener clusters. Afterwards, the images for the Garden cluster are built and deployed into the KinD cluster. Finally, the images for the Seed cluster are built, pushed to a container registry on the Seed, and the <code>gardenlet</code> is started.</p><p>If support for workload identity is required you can invoke the top command with <code>DEV_SETUP_WITH_WORKLOAD_IDENTITY_SUPPORT</code> variable set to <code>true</code>. This will cause the <a href="https://github.com/gardener/gardener-discovery-server" target="_blank" rel="noreferrer">Gardener Discovery Server</a> to be deployed and exposed through the seed cluster. External systems can be then configured to trust the workload identity issuer of the local Garden cluster.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DEV_SETUP_WITH_WORKLOAD_IDENTITY_SUPPORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">true</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardener-extensions-up</span></span></code></pre></div><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p>The Gardener Discovery Server is started with a token which is valid for 48 hours. Rerun <code>DEV_SETUP_WITH_WORKLOAD_IDENTITY_SUPPORT=true make gardener-extensions-up</code> in order to renew the token.</p><p>When working with multiple seed clusters you need to only pass <code>DEV_SETUP_WITH_WORKLOAD_IDENTITY_SUPPORT=true</code> for the one seed cluster that will be used to expose the workload identity documents. A single Garden cluster needs only one Gardener Discovery Server.</p></div><p>To setup workload identity with your provider please refer to the provider extension specific docs:</p><ul><li><a href="/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/usage/#aws-workload-identity-federation">provider-aws</a></li><li><a href="/docs/extensions/infrastructure-extensions/gardener-extension-provider-azure/usage/#azure-workload-identity-federation">provider-azure</a></li><li><a href="/docs/extensions/infrastructure-extensions/gardener-extension-provider-gcp/usage/#gcp-workload-identity-federation">provider-gcp</a></li></ul><h3 id="adding-additional-seeds" tabindex="-1">Adding Additional Seeds <a class="header-anchor" href="#adding-additional-seeds" aria-label="Permalink to &quot;Adding Additional Seeds&quot;">​</a></h3><p>Additional seed(s) can be added by running</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardener-extensions-up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SEED_NAME=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">seed-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>The seed cluster preparations are similar to the first seed:</p><p>The <code>kubeconfig</code> of your Kubernetes cluster you would like to use as seed should be placed at <code>./example/provider-extensions/seed/kubeconfig-&lt;seed-name&gt;</code>. Additionally, please maintain the configuration of your seed in <code>./example/provider-extensions/gardenlet/values-&lt;seed-name&gt;.yaml</code>. It is automatically copied from <code>values.yaml.tmpl</code> in the same directory when you run <code>make gardener-extensions-up SEED_NAME=&lt;seed-name&gt;</code> for the first time. It also includes explanations of the properties you should set.</p><h3 id="removing-a-seed" tabindex="-1">Removing a Seed <a class="header-anchor" href="#removing-a-seed" aria-label="Permalink to &quot;Removing a Seed&quot;">​</a></h3><p>If you have multiple seeds and want to remove one, just use</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardener-extensions-down</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SEED_NAME=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">seed-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>If it is not the last seed, this command will only remove the seed, but leave the local Gardener cluster and the other seeds untouched. To remove all seeds and to cleanup the local Gardener cluster, you have to run the command for each seed.</p><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>If using development setup that supports workload identity pass <code>DEV_SETUP_WITH_WORKLOAD_IDENTITY_SUPPORT=true</code> when removing the seed that was used to host the <a href="https://github.com/gardener/gardener-discovery-server" target="_blank" rel="noreferrer">Gardener Discovery Server</a>.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DEV_SETUP_WITH_WORKLOAD_IDENTITY_SUPPORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">true</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardener-extensions-down</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SEED_NAME=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">seed-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div></div><h3 id="rotate-credentials-of-container-image-registry-in-a-seed" tabindex="-1">Rotate credentials of container image registry in a Seed <a class="header-anchor" href="#rotate-credentials-of-container-image-registry-in-a-seed" aria-label="Permalink to &quot;Rotate credentials of container image registry in a Seed&quot;">​</a></h3><p>There is a container image registry in each Seed cluster where Gardener images required for the Seed and the Shoot nodes are pushed to. This registry is password protected. The password is generated when the Seed is deployed via <code>make gardener-extensions-up</code>. Afterward, it is not rotated automatically. Otherwise, this could break the update of <code>gardener-node-agent</code>, because it might not be able to pull its own new image anymore. This is no general issue of <code>gardener-node-agent</code>, but a limitation <code>provider-extensions</code> setup. Gardener does not support protected container images out of the box. The function was added for this scenario only.</p><p>However, if you want to rotate the credentials for any reason, there are two options for it.</p><ul><li>run <code>make gardener-extensions-up</code> (to ensure that your images are up-to-date)</li><li><code>reconcile</code> all shoots on the seed where you want to rotate the registry password</li><li>run <code>kubectl delete secrets -n registry registry-password</code> on your seed cluster</li><li>run <code>make gardener-extensions-up</code></li><li><code>reconcile</code> the shoots again</li></ul><p>or</p><ul><li><code>reconcile</code> all shoots on the seed where you want to rotate the registry password</li><li>run <code>kubectl delete secrets -n registry registry-password</code> on your seed cluster</li><li>run <code>./example/provider-extensions/registry-seed/deploy-registry.sh &lt;path to seed kubeconfig&gt; &lt;seed registry hostname&gt;</code></li><li><code>reconcile</code> the shoots again</li></ul><h2 id="pause-and-unpause-the-kind-cluster" tabindex="-1">Pause and Unpause the KinD Cluster <a class="header-anchor" href="#pause-and-unpause-the-kind-cluster" aria-label="Permalink to &quot;Pause and Unpause the KinD Cluster&quot;">​</a></h2><p>The KinD cluster can be paused by stopping and keeping its docker container. This can be done by running:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-extensions-down</span></span></code></pre></div><p>When you run <code>make kind-extensions-up</code> again, you will start the docker container with your previous Gardener configuration again.</p><p>This provides the option to switch off your local KinD cluster fast without leaving orphaned infrastructure elements behind.</p><h2 id="creating-a-shoot-cluster" tabindex="-1">Creating a <code>Shoot</code> Cluster <a class="header-anchor" href="#creating-a-shoot-cluster" aria-label="Permalink to &quot;Creating a `Shoot` Cluster&quot;">​</a></h2><p>You can wait for the <code>Seed</code> to be ready by running:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wait</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --for=condition=gardenletready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> seed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> provider-extensions</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --timeout=5m</span></span></code></pre></div><p><code>make kind-extensions-up</code> already includes such a check. However, it might be useful when you wake up your <code>Seed</code> from hibernation or unpause you KinD cluster.</p><p>Alternatively, you can run <code>kubectl get seed provider-extensions</code> and wait for the <code>STATUS</code> to indicate readiness:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   PROVIDER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   REGION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    VERSION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      K8S</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> VERSION</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">provider-extensions</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    gcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        europe-west1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   111m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.61.0-dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.24.7</span></span></code></pre></div><p>In order to create a first shoot cluster, please create your own <code>Shoot</code> definition and apply it to your KinD cluster. <code>gardener-scheduler</code> includes <code>candidateDeterminationStrategy: MinimalDistance</code> configuration so you are able to run schedule <code>Shoot</code>s of different providers on your <code>Seed</code>.</p><p>You can wait for your <code>Shoot</code>s to be ready by running <code>kubectl -n garden-local get shoots</code> and wait for the <code>LAST OPERATION</code> to reach <code>100%</code>. The output depends on your <code>Shoot</code> definition. This is an example output:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        CLOUDPROFILE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   PROVIDER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   REGION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         K8S</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> VERSION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   HIBERNATION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   LAST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OPERATION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    AGE</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        eu-west-1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      1.24.3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Awake</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Processing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (43%)      healthy   84s</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aws-arm64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        eu-west-1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      1.24.3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Awake</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Processing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (43%)      healthy   65s</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">azure</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       az</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             azure</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      westeurope</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1.24.2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Awake</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Processing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (43%)      healthy   57s</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         gcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            gcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        europe-west1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1.24.3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Awake</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Processing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (43%)      healthy   94s</span></span></code></pre></div><h3 id="accessing-the-shoot-cluster" tabindex="-1">Accessing the <code>Shoot</code> Cluster <a class="header-anchor" href="#accessing-the-shoot-cluster" aria-label="Permalink to &quot;Accessing the `Shoot` Cluster&quot;">​</a></h3><p>Your shoot clusters will have a public DNS entries for their API servers, so that they could be reached via the Internet via <code>kubectl</code> after you have created their <code>kubeconfig</code>.</p><p>We encourage you to use the <a href="https://github.com/gardener/gardener/blob/master/docs/proposals/16-adminkubeconfig-subresource.md" target="_blank" rel="noreferrer">adminkubeconfig subresource</a> for accessing your shoot cluster. You can find an example how to use it in <a href="/docs/gardener/shoot/shoot_access/#shootsadminkubeconfig-subresource">Accessing Shoot Clusters</a>.</p><h2 id="deleting-the-shoot-clusters" tabindex="-1">Deleting the <code>Shoot</code> Clusters <a class="header-anchor" href="#deleting-the-shoot-clusters" aria-label="Permalink to &quot;Deleting the `Shoot` Clusters&quot;">​</a></h2><p>Before tearing down your environment, you have to delete your shoot clusters. This is highly recommended because otherwise you would leave orphaned items on your infrastructure accounts.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./hack/usage/delete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shoot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your-shoo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> garden-local</span></span></code></pre></div><h2 id="tear-down-the-gardener-environment" tabindex="-1">Tear Down the Gardener Environment <a class="header-anchor" href="#tear-down-the-gardener-environment" aria-label="Permalink to &quot;Tear Down the Gardener Environment&quot;">​</a></h2><p>Before you delete your local KinD cluster, you should shut down your <code>Shoots</code> and <code>Seed</code> in a clean way to avoid orphaned infrastructure elements in your projects.</p><p>Please ensure that your KinD and Seed clusters are online (not paused or hibernated) and run:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardener-extensions-down</span></span></code></pre></div><p>This will delete all <code>Shoots</code> first (this could take a couple of minutes), then uninstall <code>gardenlet</code> from the Seed and the gardener components from the KinD. Finally, the additional components like container registry, etc., are deleted from both clusters.</p><p>When this is done, you can securely delete your local KinD cluster by running:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-extensions-clean</span></span></code></pre></div>',92)]))}const k=s(n,[["render",o]]);export{g as __pageData,k as default};
