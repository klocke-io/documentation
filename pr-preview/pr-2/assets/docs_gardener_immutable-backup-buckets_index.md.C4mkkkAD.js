import{_ as i,c as s,o as t,a2 as a}from"./chunks/framework.B8WFj13S.js";const h=JSON.parse('{"title":"Immutable Backup Buckets","description":"","frontmatter":{"github_repo":"https://github.com/gardener/gardener","github_subdir":"docs/operations","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/gardener/immutable-backup-buckets.md","to":"immutable-backup-buckets.md"},"persona":"Operators","title":"Immutable Backup Buckets","prev":false,"next":false},"headers":[],"relativePath":"docs/gardener/immutable-backup-buckets/index.md","filePath":"docs/gardener/immutable-backup-buckets.md","lastUpdated":null}'),n={name:"docs/gardener/immutable-backup-buckets/index.md"};function r(o,e,l,p,c,u){return t(),s("div",null,e[0]||(e[0]=[a(`<h1 id="immutable-backup-buckets" tabindex="-1">Immutable Backup Buckets <a class="header-anchor" href="#immutable-backup-buckets" aria-label="Permalink to &quot;Immutable Backup Buckets&quot;">​</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p><strong>Immutable backup buckets</strong> ensure that etcd backups cannot be modified or deleted before the configured retention period expires, by leveraging immutability features provided by supported cloud providers.</p><p>This capability is critical for:</p><ul><li><strong>Security</strong>: Protecting against accidental or malicious deletion of backups.</li><li><strong>Compliance</strong>: Meeting regulatory requirements for data retention.</li><li><strong>Operational integrity</strong>: Ensuring recoverable state of your Kubernetes clusters.</li></ul><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>For background, see <a href="https://github.com/gardener/gardener/issues/10866" target="_blank" rel="noreferrer">Gardener Issue #10866</a>.</p></div><h2 id="core-concepts" tabindex="-1">Core Concepts <a class="header-anchor" href="#core-concepts" aria-label="Permalink to &quot;Core Concepts&quot;">​</a></h2><p>When <strong>immutability</strong> is enabled via a supported Gardener provider extension:</p><p>The <strong>provider extension</strong> will:</p><ul><li>✅ <strong>Create</strong> the backup bucket with the desired immutability policy (if it does not already exist).</li><li>🔄 <strong>Reconcile</strong> the policy on existing buckets to match the current configuration.</li><li>🚫 <strong>Prevent changes</strong> that would weaken the policy (reduce retention period or disable immutability).</li><li>🕑 <strong>Manage deletion lifecycle</strong>: If retention lock prevents immediate deletion of objects, a deletion policy will apply when allowed.</li></ul><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p>Once a bucket&#39;s immutability is <strong>locked</strong> at the cloud provider level, it cannot be removed or shortened—even by administrators or operators.</p></div><h2 id="provider-support" tabindex="-1">Provider Support <a class="header-anchor" href="#provider-support" aria-label="Permalink to &quot;Provider Support&quot;">​</a></h2><div class="warning custom-block github-alert"><p class="custom-block-title">WARNING</p><p><strong>Not all Gardener provider extensions currently support immutable buckets.</strong> Support and configuration options vary between providers.</p></div><p>Please check your cloud provider’s extension documentation (see <a href="documentation/pr-preview/pr-2/docs/gardener/immutable-backup-buckets/#references">References</a>) for up-to-date support and syntax.</p><h2 id="how-it-works-admission-webhook-enforcement" tabindex="-1">How It Works: Admission Webhook Enforcement <a class="header-anchor" href="#how-it-works-admission-webhook-enforcement" aria-label="Permalink to &quot;How It Works: Admission Webhook Enforcement&quot;">​</a></h2><p>To ensure backup integrity, an <strong>admission webhook</strong> enforces:</p><ul><li>🔒 <strong>Immutability lock</strong>: Once the policy is locked, it cannot be disabled.</li><li>📅 <strong>Retention period</strong>: Once the policy is locked, the retention period cannot be shortened.</li></ul><p>This protects clusters from accidental misconfiguration or policy drift.</p><h2 id="how-to-enable-immutable-backup-buckets" tabindex="-1">How to Enable Immutable Backup Buckets <a class="header-anchor" href="#how-to-enable-immutable-backup-buckets" aria-label="Permalink to &quot;How to Enable Immutable Backup Buckets&quot;">​</a></h2><p>To enable immutable backup buckets: 1️⃣ Set the <strong>immutability options</strong> in <code>.spec.backup.providerConfig</code> of your <code>Seed</code> resource. 2️⃣ The <strong>Gardenlet</strong> and the provider extension will collaborate to provision and manage the bucket.</p><h3 id="example-configuration" tabindex="-1">Example Configuration <a class="header-anchor" href="#example-configuration" aria-label="Permalink to &quot;Example Configuration&quot;">​</a></h3><p>Below is a <strong>generic example</strong>; adjust according to your cloud provider’s API:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">core.gardener.cloud/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Seed</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">example-seed</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  backup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    provider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;provider-name&gt;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    providerConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;provider-extension-api-version&gt;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">BackupBucketConfig</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      immutability</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        retentionPeriod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">96h</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # Required: Retention duration (e.g., 96h)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        retentionType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">bucket</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         # Bucket-level or object-level (provider-specific)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        locked</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 # Whether to lock policy on creation (recommended: true for production)</span></span></code></pre></div><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>See your provider’s documentation for specific fields and behavior:</p><ul><li><a href="documentation/pr-preview/pr-2/docs/extensions/infrastructure-extensions/gardener-extension-provider-gcp/usage/#backupbucketconfig">GCP BackupBucketConfig</a></li><li><a href="documentation/pr-preview/pr-2/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/usage/#backupbucketconfig">AWS BackupBucketConfig</a></li><li><a href="documentation/pr-preview/pr-2/docs/extensions/infrastructure-extensions/gardener-extension-provider-azure/usage/#backupbucketconfig">Azure BackupBucketConfig</a></li></ul></div><h2 id="advanced-ignoring-snapshots-during-restoration" tabindex="-1">Advanced: Ignoring Snapshots During Restoration <a class="header-anchor" href="#advanced-ignoring-snapshots-during-restoration" aria-label="Permalink to &quot;Advanced: Ignoring Snapshots During Restoration&quot;">​</a></h2><p>When using immutable backup buckets, you may encounter situations where certain snapshots cannot be deleted due to immutability constraints. In such cases, you can configure the etcd-backup-restore tool to <strong>ignore problematic snapshots</strong> during restoration. This allows you to proceed with restoring the etcd cluster without being blocked by snapshots that cannot be deleted.</p><div class="warning custom-block github-alert"><p class="custom-block-title">WARNING</p><p><strong>Ignoring snapshots should be used with caution</strong>. It is recommended to only ignore snapshots that you are certain are not needed for recovery, as this may lead to data loss if critical snapshots are skipped.</p></div><p>👉 See: <a href="https://github.com/gardener/etcd-backup-restore/blob/master/docs/usage/enabling_immutable_snapshots.md#ignoring-snapshots-during-restoration" target="_blank" rel="noreferrer">Ignoring Snapshots During Restoration</a>.</p><h2 id="references" tabindex="-1">References <a class="header-anchor" href="#references" aria-label="Permalink to &quot;References&quot;">​</a></h2><ul><li><a href="documentation/pr-preview/pr-2/docs/gardener/extensions/resources/backupbucket/">BackupBucket Resource Contract</a></li><li><a href="documentation/pr-preview/pr-2/docs/gardener/concepts/gardenlet/#backupbucket-controller">Gardenlet Controller Concepts – BackupBucket Controller</a></li><li><a href="documentation/pr-preview/pr-2/docs/extensions/infrastructure-extensions/gardener-extension-provider-gcp/usage/#backupbucketconfig">GCP BackupBucketConfig</a></li><li><a href="documentation/pr-preview/pr-2/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/usage/#backupbucketconfig">AWS BackupBucketConfig</a></li><li><a href="documentation/pr-preview/pr-2/docs/extensions/infrastructure-extensions/gardener-extension-provider-azure/usage/#backupbucketconfig">Azure BackupBucketConfig</a></li><li><a href="https://github.com/gardener/etcd-backup-restore/blob/master/docs/usage/enabling_immutable_snapshots.md" target="_blank" rel="noreferrer">etcd-backup-restore: Enabling Immutable Snapshots</a></li></ul>`,30)]))}const k=i(n,[["render",r]]);export{h as __pageData,k as default};
