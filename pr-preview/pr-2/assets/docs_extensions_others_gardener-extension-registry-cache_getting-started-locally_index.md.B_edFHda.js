import{_ as t,c as a,o as r,a2 as i}from"./chunks/framework.B8WFj13S.js";const g=JSON.parse('{"title":"Deploying Registry Cache Extension Locally","description":"Learn how to set up a local development environment","frontmatter":{"description":"Learn how to set up a local development environment","github_repo":"https://github.com/gardener/gardener-extension-registry-cache","github_subdir":"docs/development","params":{"github_branch":"main"},"path_base_for_github_subdir":{"from":"content/docs/extensions/others/gardener-extension-registry-cache/getting-started-locally.md","to":"getting-started-locally.md"},"persona":"Developers","title":"Deploying Registry Cache Extension Locally","prev":false,"next":false},"headers":[],"relativePath":"docs/extensions/others/gardener-extension-registry-cache/getting-started-locally/index.md","filePath":"docs/extensions/others/gardener-extension-registry-cache/getting-started-locally.md","lastUpdated":null}'),s={name:"docs/extensions/others/gardener-extension-registry-cache/getting-started-locally/index.md"};function n(o,e,l,h,c,d){return r(),a("div",null,e[0]||(e[0]=[i('<h1 id="deploying-registry-cache-extension-locally" tabindex="-1">Deploying Registry Cache Extension Locally <a class="header-anchor" href="#deploying-registry-cache-extension-locally" aria-label="Permalink to &quot;Deploying Registry Cache Extension Locally&quot;">​</a></h1><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">​</a></h2><ul><li>Make sure that you have a running local Gardener setup. The steps to complete this can be found in the <a href="documentation/pr-preview/pr-2/docs/gardener/deployment/getting_started_locally/">Deploying Gardener Locally guide</a>.</li></ul><h2 id="setting-up-the-registry-cache-extension" tabindex="-1">Setting up the Registry Cache Extension <a class="header-anchor" href="#setting-up-the-registry-cache-extension" aria-label="Permalink to &quot;Setting up the Registry Cache Extension&quot;">​</a></h2><p>Make sure that your <code>KUBECONFIG</code> environment variable is targeting the local Gardener cluster. When this is ensured, run:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> extension-up</span></span></code></pre></div><p>The corresponding make target will build the extension image, load it into the kind cluster Nodes, and deploy the registry-cache ControllerDeployment and ControllerRegistration resources. The container image in the ControllerDeployment will be the image that was build and loaded into the kind cluster Nodes.</p><p>The make target will then deploy the registry-cache admission component. It will build the admission image, load it into the kind cluster Nodes, and finally install the admission component charts to the kind cluster.</p><h2 id="creating-a-shoot-cluster" tabindex="-1">Creating a Shoot Cluster <a class="header-anchor" href="#creating-a-shoot-cluster" aria-label="Permalink to &quot;Creating a Shoot Cluster&quot;">​</a></h2><p>Once the above step is completed, you can create a Shoot cluster.</p><p><a href="https://github.com/gardener/gardener-extension-registry-cache/blob/main/example/shoot-registry-cache.yaml" target="_blank" rel="noreferrer"><code>example/shoot-registry-cache.yaml</code></a> contains a Shoot specification with the <code>registry-cache</code> extension:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> example/shoot-registry-cache.yaml</span></span></code></pre></div><p><a href="https://github.com/gardener/gardener-extension-registry-cache/blob/main/example/shoot-registry-mirror.yaml" target="_blank" rel="noreferrer"><code>example/shoot-registry-mirror.yaml</code></a> contains a Shoot specification with the <code>registry-mirror</code> extension:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> example/shoot-registry-mirror.yaml</span></span></code></pre></div><h2 id="tearing-down-the-development-environment" tabindex="-1">Tearing Down the Development Environment <a class="header-anchor" href="#tearing-down-the-development-environment" aria-label="Permalink to &quot;Tearing Down the Development Environment&quot;">​</a></h2><p>To tear down the development environment, delete the Shoot cluster or disable the <code>registry-cache</code> extension in the Shoot&#39;s specification. When the extension is not used by the Shoot anymore, you can run:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> extension-down</span></span></code></pre></div><p>The make target will delete the ControllerDeployment and ControllerRegistration of the extension, and the registry-cache admission helm deployment.</p><h2 id="alternative-setup-using-the-gardener-operator-local-setup" tabindex="-1">Alternative Setup Using the <code>gardener-operator</code> Local Setup <a class="header-anchor" href="#alternative-setup-using-the-gardener-operator-local-setup" aria-label="Permalink to &quot;Alternative Setup Using the `gardener-operator` Local Setup&quot;">​</a></h2><p>Alternatively, you can deploy the registry-cache extension in the <code>gardener-operator</code> local setup. To do this, make sure you are have a running local setup based on <a href="documentation/pr-preview/pr-2/docs/gardener/deployment/getting_started_locally/#alternative-way-to-set-up-garden-and-seed-leveraging-gardener-operator">Alternative Way to Set Up Garden and Seed Leveraging <code>gardener-operator</code></a>. The <code>KUBECONFIG</code> environment variable should target the operator local KinD cluster (i.e. <code>&lt;path_to_gardener_project&gt;/example/gardener-local/kind/operator/kubeconfig</code>).</p><h4 id="creating-the-registry-cache-extension-operator-gardener-cloud-resource" tabindex="-1">Creating the registry-cache <code>Extension.operator.gardener.cloud</code> resource: <a class="header-anchor" href="#creating-the-registry-cache-extension-operator-gardener-cloud-resource" aria-label="Permalink to &quot;Creating the registry-cache `Extension.operator.gardener.cloud` resource:&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> extension-operator-up</span></span></code></pre></div><p>The corresponding make target will build the registry-cache admission and extension container images, OCI artifacts for the admission runtime and application charts, and the extension chart. Then, the container images and the OCI artifacts are pushed into the default skaffold registry (i.e. <code>garden.local.gardener.cloud:5001</code>). Next, the registry-cache <code>Extension.operator.gardener.cloud</code> resource is deployed into the KinD cluster. Based on this resource the gardener-operator will deploy the registry-cache admission component, as well as the registry-cache ControllerDeployment and ControllerRegistration resources.</p><h4 id="creating-a-shoot-cluster-1" tabindex="-1">Creating a Shoot Cluster <a class="header-anchor" href="#creating-a-shoot-cluster-1" aria-label="Permalink to &quot;Creating a Shoot Cluster&quot;">​</a></h4><p>To create a Shoot cluster the <code>KUBECONFIG</code> environment variable should target virtual garden cluster (i.e. <code>&lt;path_to_gardener_project&gt;/example/operator/virtual-garden/kubeconfig</code>) and then execute:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> example/shoot-registry-cache.yaml</span></span></code></pre></div><h4 id="delete-the-registry-cache-extension-operator-gardener-cloud-resource" tabindex="-1">Delete the registry-cache <code>Extension.operator.gardener.cloud</code> resource <a class="header-anchor" href="#delete-the-registry-cache-extension-operator-gardener-cloud-resource" aria-label="Permalink to &quot;Delete the registry-cache `Extension.operator.gardener.cloud` resource&quot;">​</a></h4><p>Make sure the environment variable <code>KUBECONFIG</code> points to the operator&#39;s local KinD cluster and then run:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> extension-operator-down</span></span></code></pre></div><p>The corresponding make target will delete the <code>Extension.operator.gardener.cloud</code> resource. Consequently, the gardener-operator will delete the registry-cache admission component and registry-cache ControllerDeployment and ControllerRegistration resources.</p>',30)]))}const u=t(s,[["render",n]]);export{g as __pageData,u as default};
