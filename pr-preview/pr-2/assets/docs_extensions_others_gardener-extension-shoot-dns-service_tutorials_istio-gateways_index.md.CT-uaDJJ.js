import{_ as i,c as a,o as n,a2 as t}from"./chunks/framework.Bfq10Vlj.js";const d=JSON.parse('{"title":"Istio Gateways","description":"","frontmatter":{"github_repo":"https://github.com/gardener/gardener-extension-shoot-dns-service","github_subdir":"docs/usage/tutorials","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/extensions/others/gardener-extension-shoot-dns-service/tutorials/istio-gateways.md","to":"istio-gateways.md"},"persona":"Users","title":"Istio Gateways","prev":false,"next":false},"headers":[],"relativePath":"docs/extensions/others/gardener-extension-shoot-dns-service/tutorials/istio-gateways/index.md","filePath":"docs/extensions/others/gardener-extension-shoot-dns-service/tutorials/istio-gateways.md","lastUpdated":null}'),e={name:"docs/extensions/others/gardener-extension-shoot-dns-service/tutorials/istio-gateways/index.md"};function l(h,s,p,k,r,F){return n(),a("div",null,s[0]||(s[0]=[t(`<h1 id="using-annotated-istio-gateway-and-or-istio-virtual-service-as-source" tabindex="-1">Using annotated Istio Gateway and/or Istio Virtual Service as Source <a class="header-anchor" href="#using-annotated-istio-gateway-and-or-istio-virtual-service-as-source" aria-label="Permalink to &quot;Using annotated Istio Gateway and/or Istio Virtual Service as Source&quot;">​</a></h1><p>This tutorial describes how to use annotated Istio Gateway resources as source for DNSEntries with the Gardener shoot-dns-service extension.</p><h2 id="install-istio-on-your-cluster" tabindex="-1">Install Istio on your cluster <a class="header-anchor" href="#install-istio-on-your-cluster" aria-label="Permalink to &quot;Install Istio on your cluster&quot;">​</a></h2><p>Using a new or existing shoot cluster, follow the <a href="https://istio.io/latest/docs/setup/getting-started/" target="_blank" rel="noreferrer">Istio Getting Started</a> to download and install Istio.</p><p>These are the typical commands for the istio demo installation</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> KUEBCONFIG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -L</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://istio.io/downloadIstio</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">istioctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> profile=demo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> label</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> istio-injection=enabled</span></span></code></pre></div><h2 id="verify-that-istio-gateway-virtualservice-source-works" tabindex="-1">Verify that Istio Gateway/VirtualService Source works <a class="header-anchor" href="#verify-that-istio-gateway-virtualservice-source-works" aria-label="Permalink to &quot;Verify that Istio Gateway/VirtualService Source works&quot;">​</a></h2><h3 id="install-a-sample-service" tabindex="-1">Install a sample service <a class="header-anchor" href="#install-a-sample-service" aria-label="Permalink to &quot;Install a sample service&quot;">​</a></h3><p>With automatic sidecar injection:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://raw.githubusercontent.com/istio/istio/release-1.20/samples/httpbin/httpbin.yaml</span></span></code></pre></div><h3 id="using-a-gateway-as-a-source" tabindex="-1">Using a Gateway as a source <a class="header-anchor" href="#using-a-gateway-as-a-source" aria-label="Permalink to &quot;Using a Gateway as a source&quot;">​</a></h3><h4 id="create-an-istio-gateway" tabindex="-1">Create an Istio Gateway: <a class="header-anchor" href="#create-an-istio-gateway" aria-label="Permalink to &quot;Create an Istio Gateway:&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apiVersion: networking.istio.io/v1alpha3</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kind: Gateway</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  name: httpbin-gateway</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  namespace: istio-system</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  annotations:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    dns.gardener.cloud/dnsnames: &quot;*&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    dns.gardener.cloud/class: garden</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">spec:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  selector:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    istio: ingressgateway # use Istio default gateway implementation</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  servers:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  - port:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      number: 80</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      name: http</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      protocol: HTTP</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    hosts:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - &quot;httpbin.example.com&quot; # this is used by the dns-controller-manager to extract DNS names</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><h4 id="configure-routes-for-traffic-entering-via-the-gateway" tabindex="-1">Configure routes for traffic entering via the Gateway: <a class="header-anchor" href="#configure-routes-for-traffic-entering-via-the-gateway" aria-label="Permalink to &quot;Configure routes for traffic entering via the Gateway:&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apiVersion: networking.istio.io/v1alpha3</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kind: VirtualService</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  name: httpbin</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  namespace: default</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">spec:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  hosts:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  - &quot;httpbin.example.com&quot; # this is also used by the dns-controller-manager to extract DNS names</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  gateways:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  - istio-system/httpbin-gateway</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  http:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  - match:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - uri:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        prefix: /status</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - uri:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        prefix: /delay</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    route:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - destination:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        port:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          number: 8000</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        host: httpbin</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><p>You should now see events in the namespace of the gateway:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> istio-system</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> events</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --sort-by=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.metadata.creationTimestamp}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LAST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SEEN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   TYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      REASON</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                 OBJECT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                       MESSAGE</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">38s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Normal</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    dns-annotation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         gateway/httpbin-gateway</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      httpbin.example.com:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> created</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dns</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> entry</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> object</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shoot--foo--bar/httpbin-gateway-gateway-zpf8n</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">38s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Normal</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    dns-annotation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         gateway/httpbin-gateway</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      httpbin.example.com:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dns</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> entry</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pending:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> waiting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dns</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reconciliation</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">38s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Normal</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    dns-annotation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         gateway/httpbin-gateway</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      httpbin.example.com:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dns</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> entry</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pending</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">36s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Normal</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    dns-annotation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         gateway/httpbin-gateway</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      httpbin.example.com:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dns</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> entry</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> active</span></span></code></pre></div><h3 id="using-a-virtualservice-as-a-source" tabindex="-1">Using a VirtualService as a source <a class="header-anchor" href="#using-a-virtualservice-as-a-source" aria-label="Permalink to &quot;Using a VirtualService as a source&quot;">​</a></h3><p>If the <code>Gateway</code> resource is annotated with <code>dns.gardener.cloud/dnsnames: &quot;*&quot;</code>, hosts from all referencing <code>VirtualServices</code> resources are automatically extracted. These resources don&#39;t need an additional annotation.</p><h4 id="create-an-istio-gateway-1" tabindex="-1">Create an Istio Gateway: <a class="header-anchor" href="#create-an-istio-gateway-1" aria-label="Permalink to &quot;Create an Istio Gateway:&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apiVersion: networking.istio.io/v1alpha3</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kind: Gateway</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  name: httpbin-gateway</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  namespace: istio-system</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  annotations:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    dns.gardener.cloud/dnsnames: &quot;*&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    dns.gardener.cloud/class: garden</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">spec:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  selector:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    istio: ingressgateway # use Istio default gateway implementation</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  servers:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  - port:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      number: 80</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      name: http</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      protocol: HTTP</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    hosts:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - &quot;*&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><h4 id="configure-routes-for-traffic-entering-via-the-gateway-1" tabindex="-1">Configure routes for traffic entering via the Gateway: <a class="header-anchor" href="#configure-routes-for-traffic-entering-via-the-gateway-1" aria-label="Permalink to &quot;Configure routes for traffic entering via the Gateway:&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apiVersion: networking.istio.io/v1alpha3</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kind: VirtualService</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  name: httpbin</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  namespace: default  </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">spec:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  hosts:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  - &quot;httpbin.example.com&quot; # this is used by dns-controller-manager to extract DNS names</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  gateways:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  - istio-system/httpbin-gateway</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  http:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  - match:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - uri:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        prefix: /status</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - uri:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        prefix: /delay</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    route:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - destination:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        port:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          number: 8000</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        host: httpbin</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><p>This should show a similar events as above.</p><p>To get the targets to the extracted DNS names, the shoot-dns-service controller is able to gather information from the kubernetes service of the Istio Ingress Gateway.</p><p><strong>Note</strong>: It is also possible to set the targets my specifying an Ingress resource using the <code>dns.gardener.cloud/ingress</code> annotation on the Istio Ingress Gateway resource.</p><p><strong>Note</strong>: It is also possible to set the targets manually by using the <code>dns.gardener.cloud/targets</code> annotation on the Istio Ingress Gateway resource.</p><h3 id="access-the-sample-service-using-curl" tabindex="-1">Access the sample service using <code>curl</code> <a class="header-anchor" href="#access-the-sample-service-using-curl" aria-label="Permalink to &quot;Access the sample service using \`curl\`&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://httpbin.example.com/status/200</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HTTP/1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">server:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> istio-envoy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Tue,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Feb</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 07:49:37</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GMT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">content-type:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> text/html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; charset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">utf-8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">access-control-allow-origin:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">access-control-allow-credentials:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">content-length:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">x-envoy-upstream-service-time:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 15</span></span></code></pre></div><p>Accessing any other URL that has not been explicitly exposed should return an HTTP 404 error:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://httpbin.example.com/headers</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HTTP/1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 404</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Not</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Found</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Tue,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Feb</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 08:09:41</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GMT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">server:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> istio-envoy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">transfer-encoding:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chunked</span></span></code></pre></div>`,31)]))}const g=i(e,[["render",l]]);export{d as __pageData,g as default};
