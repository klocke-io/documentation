import{_ as t,c as i,o as d,a2 as n,j as e,a}from"./chunks/framework.B8WFj13S.js";const k=JSON.parse('{"title":"Dwd Using Local Garden","description":"","frontmatter":{"github_repo":"https://github.com/gardener/dependency-watchdog","github_subdir":"docs/development/setup","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/other-components/dependency-watchdog/setup/dwd-using-local-garden.md","to":"dwd-using-local-garden.md"},"persona":"Developers","title":"Dwd Using Local Garden","prev":false,"next":false},"headers":[],"relativePath":"docs/other-components/dependency-watchdog/setup/dwd-using-local-garden/index.md","filePath":"docs/other-components/dependency-watchdog/setup/dwd-using-local-garden.md","lastUpdated":null}'),r={name:"docs/other-components/dependency-watchdog/setup/dwd-using-local-garden/index.md"};function l(o,s,h,c,p,u){return d(),i("div",null,s[0]||(s[0]=[n('<h1 id="dependency-watchdog-with-local-garden-cluster" tabindex="-1">Dependency Watchdog with Local Garden Cluster <a class="header-anchor" href="#dependency-watchdog-with-local-garden-cluster" aria-label="Permalink to &quot;Dependency Watchdog with Local Garden Cluster&quot;">​</a></h1><h2 id="setting-up-local-garden-cluster" tabindex="-1">Setting up Local Garden cluster <a class="header-anchor" href="#setting-up-local-garden-cluster" aria-label="Permalink to &quot;Setting up Local Garden cluster&quot;">​</a></h2><p>A convenient way to test local dependency-watchdog changes is to use a local garden cluster. To setup a local garden cluster you can follow the <a href="/documentation/pr-preview/pr-2/docs/gardener/deployment/getting_started_locally/">setup-guide</a>.</p><h2 id="dependency-watchdog-resources" tabindex="-1">Dependency Watchdog resources <a class="header-anchor" href="#dependency-watchdog-resources" aria-label="Permalink to &quot;Dependency Watchdog resources&quot;">​</a></h2><p>As part of the local garden installation, a <code>local</code> seed will be available.</p><h3 id="dependency-watchdog-resources-created-in-the-seed" tabindex="-1">Dependency Watchdog resources created in the seed <a class="header-anchor" href="#dependency-watchdog-resources-created-in-the-seed" aria-label="Permalink to &quot;Dependency Watchdog resources created in the seed&quot;">​</a></h3><h4 id="namespaced-resources" tabindex="-1">Namespaced resources <a class="header-anchor" href="#namespaced-resources" aria-label="Permalink to &quot;Namespaced resources&quot;">​</a></h4><p>In the <code>garden</code> namespace of the seed cluster, following resources will be created:</p>',8),e("table",{tabindex:"0"},[e("thead",null,[e("tr",null,[e("th",null,"Resource (GVK)"),e("th",null,"Name")])]),e("tbody",null,[e("tr",null,[e("td",{"apiVersion:":"","v1,":"","Kind:":"",ServiceAccount:""}),e("td",null,"dependency-watchdog-prober")]),e("tr",null,[e("td",{"apiVersion:":"","v1,":"","Kind:":"",ServiceAccount:""}),e("td",null,"dependency-watchdog-weeder")]),e("tr",null,[e("td",{"apiVersion:":"","appsv1,":"","Kind:":"",Deployment:""}),e("td",null,"dependency-watchdog-prober")]),e("tr",null,[e("td",{"apiVersion:":"","appsv1,":"","Kind:":"",Deployment:""}),e("td",null,"dependency-watchdog-weeder")]),e("tr",null,[e("td",{"apiVersion:":"","v1,":"","Kind:":"",ConfigMap:""}),e("td",null,"dependency-watchdog-prober-*")]),e("tr",null,[e("td",{"apiVersion:":"","v1,":"","Kind:":"",ConfigMap:""}),e("td",null,"dependency-watchdog-weeder-*")]),e("tr",null,[e("td",{"apiVersion:":"","rbac.authorization.k8s.iov1,":"","Kind:":"",Role:""}),e("td",null,"gardener.cloud:dependency-watchdog-prober:role")]),e("tr",null,[e("td",{"apiVersion:":"","rbac.authorization.k8s.iov1,":"","Kind:":"",Role:""}),e("td",null,"gardener.cloud:dependency-watchdog-weeder:role")]),e("tr",null,[e("td",{"apiVersion:":"","rbac.authorization.k8s.iov1,":"","Kind:":"",RoleBinding:""}),e("td",null,"gardener.cloud:dependency-watchdog-prober:role-binding")]),e("tr",null,[e("td",{"apiVersion:":"","rbac.authorization.k8s.iov1,":"","Kind:":"",RoleBinding:""}),e("td",null,"gardener.cloud:dependency-watchdog-weeder:role-binding")]),e("tr",null,[e("td",{"apiVersion:":"","resources.gardener.cloudv1alpha1,":"","Kind:":"",ManagedResource:""}),e("td",null,"dependency-watchdog-prober")]),e("tr",null,[e("td",{"apiVersion:":"","resources.gardener.cloudv1alpha1,":"","Kind:":"",ManagedResource:""}),e("td",null,"dependency-watchdog-weeder")]),e("tr",null,[e("td",{"apiVersion:":"","v1,":"","Kind:":"",Secret:""}),e("td",null,"managedresource-dependency-watchdog-weeder")]),e("tr",null,[e("td",{"apiVersion:":"","v1,":"","Kind:":"",Secret:""}),e("td",null,"managedresource-dependency-watchdog-prober")])])],-1),e("h4",{id:"cluster-resources",tabindex:"-1"},[a("Cluster resources "),e("a",{class:"header-anchor",href:"#cluster-resources","aria-label":'Permalink to "Cluster resources"'},"​")],-1),e("table",{tabindex:"0"},[e("thead",null,[e("tr",null,[e("th",null,"Resource (GVK)"),e("th",null,"Name")])]),e("tbody",null,[e("tr",null,[e("td",{"apiVersion:":"","rbac.authorization.k8s.iov1,":"","Kind:":"",ClusterRole:""}),e("td",null,"gardener.cloud:dependency-watchdog-prober:cluster-role")]),e("tr",null,[e("td",{"apiVersion:":"","rbac.authorization.k8s.iov1,":"","Kind:":"",ClusterRole:""}),e("td",null,"gardener.cloud:dependency-watchdog-weeder:cluster-role")]),e("tr",null,[e("td",{"apiVersion:":"","rbac.authorization.k8s.iov1,":"","Kind:":"",ClusterRoleBinding:""}),e("td",null,"gardener.cloud:dependency-watchdog-prober:cluster-role-binding")]),e("tr",null,[e("td",{"apiVersion:":"","rbac.authorization.k8s.iov1,":"","Kind:":"",ClusterRoleBinding:""}),e("td",null,"gardener.cloud:dependency-watchdog-weeder:cluster-role-binding")])])],-1),e("h3",{id:"dependency-watchdog-resources-created-in-shoot-control-namespace",tabindex:"-1"},[a("Dependency Watchdog resources created in Shoot control namespace "),e("a",{class:"header-anchor",href:"#dependency-watchdog-resources-created-in-shoot-control-namespace","aria-label":'Permalink to "Dependency Watchdog resources created in Shoot control namespace"'},"​")],-1),e("table",{tabindex:"0"},[e("thead",null,[e("tr",null,[e("th",null,"Resource (GVK)"),e("th",null,"Name")])]),e("tbody",null,[e("tr",null,[e("td",{"apiVersion:":"","v1,":"","Kind:":"",Secret:""}),e("td",null,"dependency-watchdog-prober")]),e("tr",null,[e("td",{"apiVersion:":"","resources.gardener.cloudv1alpha1,":"","Kind:":"",ManagedResource:""}),e("td",null,"shoot-core-dependency-watchdog")])])],-1),e("h3",{id:"dependency-watchdog-resources-created-in-the-kube-node-lease-namespace-of-the-shoot",tabindex:"-1"},[a("Dependency Watchdog resources created in the kube-node-lease namespace of the shoot "),e("a",{class:"header-anchor",href:"#dependency-watchdog-resources-created-in-the-kube-node-lease-namespace-of-the-shoot","aria-label":'Permalink to "Dependency Watchdog resources created in the kube-node-lease namespace of the shoot"'},"​")],-1),e("table",{tabindex:"0"},[e("thead",null,[e("tr",null,[e("th",null,"Resource (GVK)"),e("th",null,"Name")])]),e("tbody",null,[e("tr",null,[e("td",{"apiVersion:":"","rbac.authorization.k8s.iov1,":"","Kind:":"",Role:""}),e("td",null,"gardener.cloud:target:dependency-watchdog")]),e("tr",null,[e("td",{"apiVersion:":"","rbac.authorization.k8s.iov1,":"","Kind:":"",RoleBinding:""}),e("td",null,"gardener.cloud:target:dependency-watchdog")])])],-1),n(`<p>These will be created by the GRM and will have a managed resource named <code>shoot-core-dependency-watchdog</code> in the shoot namespace in the seed.</p><h2 id="update-gardener-with-custom-dependency-watchdog-docker-images" tabindex="-1">Update Gardener with custom Dependency Watchdog Docker images <a class="header-anchor" href="#update-gardener-with-custom-dependency-watchdog-docker-images" aria-label="Permalink to &quot;Update Gardener with custom Dependency Watchdog Docker images&quot;">​</a></h2><h3 id="build-tag-and-push-docker-images" tabindex="-1">Build, Tag and Push docker images <a class="header-anchor" href="#build-tag-and-push-docker-images" aria-label="Permalink to &quot;Build, Tag and Push docker images&quot;">​</a></h3><p>To build dependency watchdog docker images run the following make target:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> make docker-build</span></span></code></pre></div><p>Local gardener hosts a docker registry which can be access at <code>localhost:5001</code>. To enable local gardener to be able to access the custom docker images you need to tag and push these images to the embedded docker registry. To do that execute the following commands:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> docker images</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Get the IMAGE ID of the dependency watchdog images that were built using docker-build make target.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> docker tag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">IMAGE-ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> localhost:5001/europe-docker.pkg.dev/gardener-project/public/gardener/dependency-watchdog-prober:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TAGNAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> docker push localhost:5001/europe-docker.pkg.dev/gardener-project/public/gardener/dependency-watchdog-prober:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TAGNAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><h3 id="update-managedresource" tabindex="-1">Update ManagedResource <a class="header-anchor" href="#update-managedresource" aria-label="Permalink to &quot;Update ManagedResource&quot;">​</a></h3><p>Garden resource manager will revert back any changes that are done to the kubernetes deployment for dependency watchdog. This is quite useful in live landscapes where only tested and qualified images are used for all gardener managed components. Any change therefore is automatically reverted.</p><p>However, during development and testing you will need to use custom docker images. To prevent garden resource manager from reverting the changes done to the kubernetes deployment for dependency watchdog components you must update the respective managed resources first.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># List the managed resources</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kubectl get mr -n garden </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dependency</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Sample response</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dependency-watchdog-weeder</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            seed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    True</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      True</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      False</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         26h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dependency-watchdog-prober</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            seed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    True</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      True</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      False</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         26h</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Lets assume that you are currently testing prober and would like to use a custom docker image</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kubectl edit mr dependency-watchdog-prober -n garden</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This will open the resource YAML for editing. Add the annotation resources.gardener.cloud/ignore=true</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Reference: https://github.com/gardener/gardener/blob/master/docs/concepts/resource-manager.md</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Save the YAML file.</span></span></code></pre></div><p>When you are done with your testing then you can again edit the ManagedResource and remove the annotation. Garden resource manager will revert back to the image with which gardener was initially built and started.</p><h3 id="update-kubernetes-deployment" tabindex="-1">Update Kubernetes Deployment <a class="header-anchor" href="#update-kubernetes-deployment" aria-label="Permalink to &quot;Update Kubernetes Deployment&quot;">​</a></h3><p>Find and update the kubernetes deployment for dependency watchdog.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kubectl get deploy -n garden </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dependency</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Sample response</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dependency-watchdog-weeder</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           26h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dependency-watchdog-prober</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           26h</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Lets assume that you are currently testing prober and would like to use a custom docker image</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kubectl edit deploy dependency-watchdog-prober -n garden</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This will open the resource YAML for editing. Change the image or any other changes and save.</span></span></code></pre></div>`,15)]))}const y=t(r,[["render",l]]);export{k as __pageData,y as default};
