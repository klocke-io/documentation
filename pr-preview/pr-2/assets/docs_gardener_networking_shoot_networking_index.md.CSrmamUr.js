import{_ as s,c as n,o as a,a2 as t}from"./chunks/framework.B8WFj13S.js";const k=JSON.parse('{"title":"Shoot Networking Configurations","description":"Configuring Pod network. Maximum number of Nodes and Pods per Node","frontmatter":{"aliases":["/docs/gardener/shoot_networking/"],"description":"Configuring Pod network. Maximum number of Nodes and Pods per Node","github_repo":"https://github.com/gardener/gardener","github_subdir":"docs/usage/networking","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/gardener/networking/shoot_networking.md","to":"shoot_networking.md"},"persona":"Users","title":"Shoot Networking Configurations","prev":false,"next":false},"headers":[],"relativePath":"docs/gardener/networking/shoot_networking/index.md","filePath":"docs/gardener/networking/shoot_networking.md","lastUpdated":null}'),o={name:"docs/gardener/networking/shoot_networking/index.md"};function i(r,e,d,p,l,h){return a(),n("div",null,e[0]||(e[0]=[t(`<h1 id="shoot-networking-configurations" tabindex="-1">Shoot Networking Configurations <a class="header-anchor" href="#shoot-networking-configurations" aria-label="Permalink to &quot;Shoot Networking Configurations&quot;">​</a></h1><p>This document contains network related information for Shoot clusters.</p><h2 id="pod-network" tabindex="-1">Pod Network <a class="header-anchor" href="#pod-network" aria-label="Permalink to &quot;Pod Network&quot;">​</a></h2><p>A Pod network is imperative for any kind of cluster communication with Pods not started within the Node&#39;s host network. More information about the Kubernetes network model can be found in the <a href="https://kubernetes.io/docs/concepts/cluster-administration/networking/" target="_blank" rel="noreferrer">Cluster Networking</a> topic.</p><p>Gardener allows users to configure the Pod network&#39;s CIDR during Shoot creation:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">core.gardener.cloud/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Shoot</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  networking</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;some-network-extension-name&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # {calico,cilium}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    pods</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">100.96.0.0/16</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nodes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span></code></pre></div><blockquote><p>⚠️ The <code>networking.pods</code> IP configuration is immutable and cannot be changed afterwards. Please consider the following paragraph to choose a configuration which will meet your demands.</p></blockquote><p>One of the network plugin&#39;s (CNI) tasks is to assign IP addresses to Pods started in the Pod network. Different network plugins come with different IP address management (IPAM) features, so we can&#39;t give any definite advice how IP ranges should be configured. Nevertheless, we want to outline the standard configuration.</p><p>Information in <code>.spec.networking.pods</code> matches the <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-controller-manager/" target="_blank" rel="noreferrer">--cluster-cidr flag</a> of the Kube-Controller-Manager of your Shoot cluster. This IP range is divided into smaller subnets, also called <code>podCIDRs</code> (default mask <code>/24</code>) and assigned to Node objects <code>.spec.podCIDR</code>. Pods get their IP address from this smaller node subnet in a default IPAM setup. Thus, it must be guaranteed that enough of these subnets can be created for the maximum amount of nodes you expect in the cluster.</p><p><em><strong>Example 1</strong></em></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Pod network: 100.96.0.0/16</span></span>
<span class="line"><span>nodeCIDRMaskSize: /24</span></span>
<span class="line"><span>-------------------------</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Number of podCIDRs: 256 --&gt; max. Node count </span></span>
<span class="line"><span>Number of IPs per podCIDRs: 256</span></span></code></pre></div><p>With the configuration above a Shoot cluster can at most have <strong>256 nodes</strong> which are ready to run workload in the Pod network.</p><p><em><strong>Example 2</strong></em></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Pod network: 100.96.0.0/20</span></span>
<span class="line"><span>nodeCIDRMaskSize: /24</span></span>
<span class="line"><span>-------------------------</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Number of podCIDRs: 16 --&gt; max. Node count </span></span>
<span class="line"><span>Number of IPs per podCIDRs: 256</span></span></code></pre></div><p>With the configuration above a Shoot cluster can at most have <strong>16 nodes</strong> which are ready to run workload in the Pod network.</p><p>Beside the configuration in <code>.spec.networking.pods</code>, users can tune the <code>nodeCIDRMaskSize</code> used by Kube-Controller-Manager on shoot creation. A smaller IP range per node means more <code>podCIDRs</code> and thus the ability to provision more nodes in the cluster, but less available IPs for Pods running on each of the nodes.</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">core.gardener.cloud/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Shoot</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  kubernetes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    kubeControllerManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      nodeCIDRMaskSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">24</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # (default)</span></span></code></pre></div><blockquote><p>⚠️ The <code>nodeCIDRMaskSize</code> configuration is immutable and cannot be changed afterwards.</p></blockquote><p><em><strong>Example 3</strong></em></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Pod network: 100.96.0.0/20</span></span>
<span class="line"><span>nodeCIDRMaskSize: /25</span></span>
<span class="line"><span>-------------------------</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Number of podCIDRs: 32 --&gt; max. Node count </span></span>
<span class="line"><span>Number of IPs per podCIDRs: 128</span></span></code></pre></div><p>With the configuration above, a Shoot cluster can at most have <strong>32 nodes</strong> which are ready to run workload in the Pod network.</p><h2 id="reserved-networks" tabindex="-1">Reserved Networks <a class="header-anchor" href="#reserved-networks" aria-label="Permalink to &quot;Reserved Networks&quot;">​</a></h2><p>Some network ranges are reserved for specific use-cases in the communication between seeds and shoots.</p><table tabindex="0"><thead><tr><th>IPv</th><th>CIDR</th><th>Name</th><th>Purpose</th></tr></thead><tbody><tr><td>IPv6</td><td>fd8f:6d53:b97a:1::/96</td><td>Default VPN Range</td><td></td></tr><tr><td>IPv4</td><td>240.0.0.0/8</td><td>Kube-ApiServer Mapping Range</td><td>Used for the <code>kubernetes.default.svc.cluster.local</code> service in a shoot</td></tr><tr><td>IPv4</td><td>241.0.0.0/8</td><td>Seed Pod Mapping Range</td><td>Used for allowing overlapping IPv4 networks between shoot and seed. Requires non-HA control plane. Only used within the vpn pods</td></tr><tr><td>IPv4</td><td>242.0.0.0/8</td><td>Shoot Node Mapping Range</td><td>Used for allowing overlapping IPv4 networks between shoot and seed. Requires non-HA control plane. Only used within the vpn pods</td></tr><tr><td>IPv4</td><td>243.0.0.0/8</td><td>Shoot Service Mapping Range</td><td>Used for allowing overlapping IPv4 networks between shoot and seed. Requires non-HA control plane. Only used within the vpn pods</td></tr><tr><td>IPv4</td><td>244.0.0.0/8</td><td>Shoot Pod Mapping Range</td><td>Used for allowing overlapping IPv4 networks between shoot and seed. Requires non-HA control plane. Only used within the vpn pods</td></tr></tbody></table><blockquote><p>⚠️ Do not use any of the CIDR ranges mentioned above for any of the node, pod or service networks. Gardener will prevent their creation. Pre-existing shoots using reserved ranges will still work, though it is recommended to recreate them with compatible network ranges.</p></blockquote><h2 id="overlapping-ipv4-networks-between-seed-and-shoot" tabindex="-1">Overlapping IPv4 Networks between Seed and Shoot <a class="header-anchor" href="#overlapping-ipv4-networks-between-seed-and-shoot" aria-label="Permalink to &quot;Overlapping IPv4 Networks between Seed and Shoot&quot;">​</a></h2><p>IPv4 or dual-stack shoot clusters can have overlapping network ranges with their seed cluster. Gardener will disentangle the overlapping ranges by mapping them to reserved ranges within the VPN network using double network address translation (NAT). Notice that none of the reserved ranges will show up outside the VPN network, i.e., they are not routable in the seed or shoot cluster.</p><blockquote><p><strong>Note:</strong> single-stack IPv6 shoots are usually not affected due to their vastly larger address space. However, Gardener still enforces the non-overlapping condition for IPv6 networks to avoid any potential issues.</p></blockquote>`,28)]))}const g=s(o,[["render",i]]);export{k as __pageData,g as default};
