import{_ as s,c as i,o as a,a2 as n}from"./chunks/framework.Bfq10Vlj.js";const u=JSON.parse('{"title":"Shoot Scheduling Profiles","description":"Introducing `balanced` and `bin-packing` scheduling profiles","frontmatter":{"aliases":["/docs/gardener/shoot_scheduling_profiles/"],"description":"Introducing `balanced` and `bin-packing` scheduling profiles","github_repo":"https://github.com/gardener/gardener","github_subdir":"docs/usage/shoot","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/gardener/shoot/shoot_scheduling_profiles.md","to":"shoot_scheduling_profiles.md"},"persona":"Users","title":"Shoot Scheduling Profiles","prev":false,"next":false},"headers":[],"relativePath":"docs/gardener/shoot/shoot_scheduling_profiles/index.md","filePath":"docs/gardener/shoot/shoot_scheduling_profiles.md","lastUpdated":null}'),t={name:"docs/gardener/shoot/shoot_scheduling_profiles/index.md"};function o(l,e,h,r,d,p){return a(),i("div",null,e[0]||(e[0]=[n(`<h1 id="shoot-scheduling-profiles" tabindex="-1">Shoot Scheduling Profiles <a class="header-anchor" href="#shoot-scheduling-profiles" aria-label="Permalink to &quot;Shoot Scheduling Profiles&quot;">​</a></h1><p>This guide describes the available scheduling profiles and how they can be configured in the Shoot cluster. It also clarifies how a custom scheduling profile can be configured.</p><h2 id="scheduling-profiles" tabindex="-1">Scheduling Profiles <a class="header-anchor" href="#scheduling-profiles" aria-label="Permalink to &quot;Scheduling Profiles&quot;">​</a></h2><p>The scheduling process in the <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-scheduler/" target="_blank" rel="noreferrer">kube-scheduler</a> happens in a series of stages. A <a href="https://kubernetes.io/docs/reference/scheduling/config/#profiles" target="_blank" rel="noreferrer">scheduling profile</a> allows configuring the different stages of the scheduling.</p><p>As of today, Gardener supports two predefined scheduling profiles:</p><ul><li><p><code>balanced</code> (default)</p><p><strong>Overview</strong></p><p>The <code>balanced</code> profile attempts to spread Pods evenly across Nodes to obtain a more balanced resource usage. This profile provides the default kube-scheduler behavior.</p><p><strong>How it works?</strong></p><p>The kube-scheduler is started without any profiles. In such case, by default, one profile with the scheduler name <code>default-scheduler</code> is created. This profile includes the default plugins. If a Pod doesn&#39;t specify the <code>.spec.schedulerName</code> field, kube-apiserver sets it to <code>default-scheduler</code>. Then, the Pod gets scheduled by the <code>default-scheduler</code> accordingly.</p></li><li><p><code>bin-packing</code></p><p><strong>Overview</strong></p><p>The <code>bin-packing</code> profile scores Nodes based on the allocation of resources. It prioritizes Nodes with the most allocated resources. By favoring the Nodes with the most allocation, some of the other Nodes become under-utilized over time (because new Pods keep being scheduled to the most allocated Nodes). Then, the cluster-autoscaler identifies such under-utilized Nodes and removes them from the cluster. In this way, this profile provides a greater overall resource utilization (compared to the <code>balanced</code> profile).</p><blockquote><p><strong>Note:</strong> The decision of when to remove a Node is a trade-off between optimizing for utilization or the availability of resources. Removing under-utilized Nodes improves cluster utilization, but new workloads might have to wait for resources to be provisioned again before they can run.</p></blockquote><p><strong>How it works?</strong></p><p>The kube-scheduler is configured with the following bin packing profile:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kubescheduler.config.k8s.io/v1beta3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">KubeSchedulerConfiguration</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">profiles</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">schedulerName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">bin-packing-scheduler</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  pluginConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">NodeResourcesFit</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      scoringStrategy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MostAllocated</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  plugins</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    score</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      disabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">NodeResourcesBalancedAllocation</span></span></code></pre></div><p>To impose the new profile, a <code>MutatingWebhookConfiguration</code> is deployed in the Shoot cluster. The <code>MutatingWebhookConfiguration</code> intercepts <code>CREATE</code> operations for Pods and sets the <code>.spec.schedulerName</code> field to <code>bin-packing-scheduler</code>. Then, the Pod gets scheduled by the <code>bin-packing-scheduler</code> accordingly. Pods that specify a custom scheduler (i.e., having <code>.spec.schedulerName</code> different from <code>default-scheduler</code> and <code>bin-packing-scheduler</code>) are not affected.</p></li></ul><h2 id="configuring-the-scheduling-profile" tabindex="-1">Configuring the Scheduling Profile <a class="header-anchor" href="#configuring-the-scheduling-profile" aria-label="Permalink to &quot;Configuring the Scheduling Profile&quot;">​</a></h2><p>The scheduling profile can be configured via the <code>.spec.kubernetes.kubeScheduler.profile</code> field in the Shoot:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  kubernetes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    kubeScheduler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      profile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;balanced&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # or &quot;bin-packing&quot;</span></span></code></pre></div><h2 id="custom-scheduling-profiles" tabindex="-1">Custom Scheduling Profiles <a class="header-anchor" href="#custom-scheduling-profiles" aria-label="Permalink to &quot;Custom Scheduling Profiles&quot;">​</a></h2><p>The kube-scheduler&#39;s component configs allows configuring custom scheduling profiles to match the cluster needs. As of today, Gardener supports only two predefined scheduling profiles. The profile configuration in the component config is quite expressive and it is not possible to easily define profiles that would match the needs of every cluster. Because of these reasons, there are no plans to add support for new predefined scheduling profiles. If a cluster owner wants to use a custom scheduling profile, then they have to deploy (and maintain) a dedicated kube-scheduler deployment in the cluster itself.</p>`,11)]))}const k=s(t,[["render",o]]);export{u as __pageData,k as default};
