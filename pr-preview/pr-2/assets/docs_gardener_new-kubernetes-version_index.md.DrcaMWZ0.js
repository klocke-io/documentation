import{_ as r,c as t,o,a2 as a}from"./chunks/framework.Bfq10Vlj.js";const g=JSON.parse('{"title":"New Kubernetes Version","description":"","frontmatter":{"github_repo":"https://github.com/gardener/gardener","github_subdir":"docs/development","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/gardener/new-kubernetes-version.md","to":"new-kubernetes-version.md"},"persona":"Developers","title":"New Kubernetes Version","prev":false,"next":false},"headers":[],"relativePath":"docs/gardener/new-kubernetes-version/index.md","filePath":"docs/gardener/new-kubernetes-version.md","lastUpdated":null}'),n={name:"docs/gardener/new-kubernetes-version/index.md"};function i(s,e,d,l,c,h){return o(),t("div",null,e[0]||(e[0]=[a('<h1 id="adding-support-for-a-new-kubernetes-version" tabindex="-1">Adding Support For a New Kubernetes Version <a class="header-anchor" href="#adding-support-for-a-new-kubernetes-version" aria-label="Permalink to &quot;Adding Support For a New Kubernetes Version&quot;">​</a></h1><p>This document describes the steps needed to perform in order to confidently add support for a new Kubernetes <strong>minor</strong> version.</p><h2 id="kubernetes-release-responsible-plan" tabindex="-1">Kubernetes Release Responsible Plan <a class="header-anchor" href="#kubernetes-release-responsible-plan" aria-label="Permalink to &quot;Kubernetes Release Responsible Plan&quot;">​</a></h2><p><strong>Tasks:</strong></p><ul><li>Ensure Gardener and extensions are updated to support the new Kubernetes version (<a href="https://github.com/gardener/gardener/issues/11020" target="_blank" rel="noreferrer">example</a>)</li><li>Bump Golang dependencies for <code>k8s.io/*</code> and <code>sigs.k8s.io/controller-runtime</code> (<a href="https://github.com/gardener/gardener/issues/11186" target="_blank" rel="noreferrer">example</a>) [<a href="/docs/gardener/new-kubernetes-version/#bump-golang-dependencies-for-k8sio-and-sigsk8siocontroller-runtime">ref</a>]</li><li>Prepare a short (~30-60 min) session for a special edition of Gardener&#39;s Review Meeting on new key features and changes in the release</li><li>Drop support for all but the greatest/latest 5 Kubernetes minor versions (the newly added plus four prior). Drop all lower/older versions and adapt accordingly (<a href="https://github.com/gardener/gardener/pull/10664" target="_blank" rel="noreferrer">example</a>)</li></ul><table tabindex="0"><thead><tr><th>Version</th><th>Expected Release Date</th><th>Release Responsibles</th></tr></thead><tbody><tr><td>v1.32</td><td>December 11, 2024</td><td><a href="https://github.com/marc1404" target="_blank" rel="noreferrer">@marc1404</a>, <a href="https://github.com/LucaBernstein" target="_blank" rel="noreferrer">@LucaBernstein</a></td></tr><tr><td>v1.33</td><td>April 23, 2025</td><td><a href="https://github.com/Kostov6" target="_blank" rel="noreferrer">@Kostov6</a>, <a href="https://github.com/plkokanov" target="_blank" rel="noreferrer">@plkokanov</a></td></tr><tr><td>v1.34</td><td>August 27, 2025</td><td><a href="https://github.com/tobschli" target="_blank" rel="noreferrer">@tobschli</a>, <a href="https://github.com/ScheererJ" target="_blank" rel="noreferrer">@ScheererJ</a></td></tr><tr><td>v1.35</td><td>December ?, 2025</td><td><a href="https://github.com/timuthy" target="_blank" rel="noreferrer">@timuthy</a>, <a href="https://github.com/rfranzke" target="_blank" rel="noreferrer">@rfranzke</a></td></tr><tr><td>v1.36</td><td>April ?, 2026</td><td><a href="https://github.com/oliver-goetz" target="_blank" rel="noreferrer">@oliver-goetz</a>, <a href="https://github.com/ary1992" target="_blank" rel="noreferrer">@ary1992</a></td></tr><tr><td>v1.37</td><td>August ?, 2026</td><td><a href="https://github.com/acumino" target="_blank" rel="noreferrer">@acumino</a>, <a href="https://github.com/shafeeqes" target="_blank" rel="noreferrer">@shafeeqes</a></td></tr><tr><td>v1.38</td><td>December ?, 2026</td><td><a href="https://github.com/ialidzhikov" target="_blank" rel="noreferrer">@ialidzhikov</a>, TBD</td></tr></tbody></table><details><summary>Click to expand the archived release responsible associations!</summary><table tabindex="0"><thead><tr><th>Version</th><th>Expected Release Date</th><th>Release Responsibles</th></tr></thead><tbody><tr><td>v1.18</td><td>March 25, 2020</td><td><a href="https://github.com/rfranzke" target="_blank" rel="noreferrer">@rfranzke</a></td></tr><tr><td>v1.19</td><td>August 20, 2020</td><td><a href="https://github.com/rfranzke" target="_blank" rel="noreferrer">@rfranzke</a></td></tr><tr><td>v1.20</td><td>December 08, 2020</td><td><a href="https://github.com/rfranzke" target="_blank" rel="noreferrer">@rfranzke</a></td></tr><tr><td>v1.21</td><td>April 08, 2021</td><td><a href="https://github.com/rfranzke" target="_blank" rel="noreferrer">@rfranzke</a></td></tr><tr><td>v1.22</td><td>August 04, 2021</td><td><a href="https://github.com/timuthy" target="_blank" rel="noreferrer">@timuthy</a></td></tr><tr><td>v1.23</td><td>December 07, 2021</td><td><a href="https://github.com/rfranzke" target="_blank" rel="noreferrer">@rfranzke</a>, <a href="https://github.com/BeckerMax" target="_blank" rel="noreferrer">@BeckerMax</a></td></tr><tr><td>v1.24</td><td>May 03, 2022</td><td><a href="https://github.com/acumino" target="_blank" rel="noreferrer">@acumino</a></td></tr><tr><td>v1.25</td><td>August 23, 2022</td><td><a href="https://github.com/shafeeqes" target="_blank" rel="noreferrer">@shafeeqes</a></td></tr><tr><td>v1.26</td><td>December 09, 2022</td><td><a href="https://github.com/ialidzhikov" target="_blank" rel="noreferrer">@ialidzhikov</a></td></tr><tr><td>v1.27</td><td>April 11, 2023</td><td><a href="https://github.com/ary1992" target="_blank" rel="noreferrer">@ary1992</a></td></tr><tr><td>v1.28</td><td>August 15, 2023</td><td><a href="https://github.com/oliver-goetz" target="_blank" rel="noreferrer">@oliver-goetz</a></td></tr><tr><td>v1.29</td><td>December 13, 2023</td><td><a href="https://github.com/acumino" target="_blank" rel="noreferrer">@acumino</a></td></tr><tr><td>v1.30</td><td>April 17, 2024</td><td><a href="https://github.com/shafeeqes" target="_blank" rel="noreferrer">@shafeeqes</a></td></tr><tr><td>v1.31</td><td>August 13, 2024</td><td><a href="https://github.com/ialidzhikov" target="_blank" rel="noreferrer">@ialidzhikov</a></td></tr></tbody></table></details><h2 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-label="Permalink to &quot;Introduction&quot;">​</a></h2><blockquote><p>⚠️ Typically, once a minor Kubernetes version <code>vX.Y</code> is supported by Gardener, then all patch versions <code>vX.Y.Z</code> are also automatically supported without any required action. This is because patch versions do not introduce any new feature or API changes, so there is nothing that needs to be adapted in <code>gardener/gardener</code> code.</p></blockquote><p>The Kubernetes community release a new minor version roughly every 4 months. Please refer to the <a href="https://kubernetes.io/releases/release/" target="_blank" rel="noreferrer">official documentation</a> about their release cycles for any additional information.</p><p>Shortly before a new release, an &quot;umbrella&quot; issue should be opened which is used to collect the required adaptations and to track the work items. For example, <a href="https://github.com/gardener/gardener/issues/5102" target="_blank" rel="noreferrer">#5102</a> can be used as a template for the issue description. As you can see, the task of supporting a new Kubernetes version also includes the provider extensions maintained in the <code>gardener</code> GitHub organization and is not restricted to <code>gardener/gardener</code> only.</p><p>Generally, the work items can be split into two groups: The first group contains tasks specific to the changes in the given Kubernetes release, the second group contains Kubernetes release-independent tasks.</p><blockquote><p>ℹ️ Upgrading the <code>k8s.io/*</code> and <code>sigs.k8s.io/controller-runtime</code> Golang dependencies is typically tracked and worked on separately (see e.g. <a href="https://github.com/gardener/gardener/issues/4772" target="_blank" rel="noreferrer">#4772</a> or <a href="https://github.com/gardener/gardener/issues/5282" target="_blank" rel="noreferrer">#5282</a>), however, it is in the responsibility of the Kubernetes Release Responsibles to make sure the libraries get updated (see <a href="/docs/gardener/new-kubernetes-version/#bump-golang-dependencies-for-k8sio-and-sigsk8siocontroller-runtime">the respective section below</a>).</p></blockquote><h2 id="preparation" tabindex="-1">Preparation <a class="header-anchor" href="#preparation" aria-label="Permalink to &quot;Preparation&quot;">​</a></h2><p>Once a new Kubernetes version is released, two issues should be created and assigned according to the <a href="/docs/gardener/new-kubernetes-version/#kubernetes-release-responsible-plan">release responsible plan</a>. Use the most recent previous issue as a template for the new issue:</p><ul><li><a href="https://github.com/gardener/gardener/issues?q=sort%3Acreated-desc%20is%3Aissue%20%E2%98%82%EF%B8%8F-Issue%20for%20%22Support%20for%20Kubernetes%20v1.%22%20" target="_blank" rel="noreferrer">☂️-Issue for &quot;Support for Kubernetes v1.xx&quot; </a></li><li><a href="https://github.com/gardener/gardener/issues?q=sort%3Acreated-desc%20is%3Aissue%20Upgrade%20%60k8s.io%2F*%60%20to%20%60v0.%60%2C%20%60sigs.k8s.io%2Fcontroller-runtime%60%20to%20%60v0.%60" target="_blank" rel="noreferrer">Upgrade <code>k8s.io/*</code> to <code>v0.xx</code>, <code>sigs.k8s.io/controller-runtime</code> to <code>v0.xx</code></a></li></ul><h2 id="deriving-release-specific-tasks" tabindex="-1">Deriving Release-Specific Tasks <a class="header-anchor" href="#deriving-release-specific-tasks" aria-label="Permalink to &quot;Deriving Release-Specific Tasks&quot;">​</a></h2><p>Most new minor Kubernetes releases incorporate API changes, deprecations, or new features. The community announces them via their <a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/" target="_blank" rel="noreferrer">change logs</a>. In order to derive the release-specific tasks, the respective change log for the new version <code>vX.Y</code> has to be read and understood (for example, <a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.24.md" target="_blank" rel="noreferrer">the changelog</a> for <code>v1.24</code>).</p><p>As already mentioned, typical changes to watch out for are:</p><ul><li>API version promotions or deprecations</li><li>Feature gate promotions or deprecations</li><li>CLI flag changes for Kubernetes components</li><li>New default values in resources</li><li>New available fields in resources</li><li>New features potentially relevant for the Gardener system</li><li>Changes of labels or annotations Gardener relies on</li><li>...</li></ul><p>Obviously, this requires a certain experience and understanding of the Gardener project so that all &quot;relevant changes&quot; can be identified. While reading the change log, add the tasks (along with the respective PR in <code>kubernetes/kubernetes</code> to the umbrella issue).</p><blockquote><p>ℹ️ Some of the changes might be specific to certain cloud providers. Pay attention to those as well and add related tasks to the issue.</p></blockquote><h2 id="list-of-release-independent-tasks" tabindex="-1">List Of Release-Independent Tasks <a class="header-anchor" href="#list-of-release-independent-tasks" aria-label="Permalink to &quot;List Of Release-Independent Tasks&quot;">​</a></h2><p>The following paragraphs describe recurring tasks that need to be performed for each new release.</p><h3 id="make-sure-a-new-hyperkube-image-is-released" tabindex="-1">Make Sure a New <code>hyperkube</code> Image Is Released <a class="header-anchor" href="#make-sure-a-new-hyperkube-image-is-released" aria-label="Permalink to &quot;Make Sure a New `hyperkube` Image Is Released&quot;">​</a></h3><p>The <a href="https://github.com/gardener/hyperkube" target="_blank" rel="noreferrer"><code>gardener/hyperkube</code></a> repository is used to release container images consisting of the <code>kubectl</code> and <code>kubelet</code> binaries.</p><p>There is a CI/CD job that runs periodically and releases a new <code>hyperkube</code> image when there is a new Kubernetes release. Before proceeding with the next steps, make sure that a new <code>hyperkube</code> image is released for the corresponding new Kubernetes minor version. Make sure that container image is present in GCR.</p><h3 id="adapting-gardener" tabindex="-1">Adapting Gardener <a class="header-anchor" href="#adapting-gardener" aria-label="Permalink to &quot;Adapting Gardener&quot;">​</a></h3><ul><li>Allow instantiation of a Kubernetes client for the new minor version and update the <code>README.md</code>: <ul><li>See <a href="https://github.com/gardener/gardener/pull/11197/commits/223bdc0ebdf79f02ac1e50fabe2b92bec3fc1e36" target="_blank" rel="noreferrer">this</a> and <a href="https://github.com/gardener/gardener/pull/11197/commits/8f1f73c6a0ce74ec952e817451244c4fa86e6bc8" target="_blank" rel="noreferrer">this</a> example commit.</li><li>The list of supported versions is meanwhile maintained <a href="https://github.com/gardener/gardener/blob/master/pkg/utils/validation/kubernetesversion/version.go" target="_blank" rel="noreferrer">here</a> in the <code>SupportedVersions</code> variable.</li></ul></li><li>Maintain the Kubernetes feature gates used for validation of <code>Shoot</code> resources: <ul><li>The feature gates are maintained in <a href="https://github.com/gardener/gardener/blob/master/pkg/utils/validation/features/featuregates.go" target="_blank" rel="noreferrer">this</a> file.</li><li>To maintain this list for new Kubernetes versions, run <code>hack/compare-k8s-feature-gates.sh &lt;old-version&gt; &lt;new-version&gt;</code> (e.g. <code>hack/compare-k8s-feature-gates.sh v1.33 v1.34</code>).</li><li>It will present 3 lists of feature gates: those added and those removed in <code>&lt;new-version&gt;</code> compared to <code>&lt;old-version&gt;</code> and feature gates that got locked to default in <code>&lt;new-version&gt;</code>.</li><li>Add all added feature gates to the map with <code>&lt;new-version&gt;</code> as <code>AddedInVersion</code> and no <code>RemovedInVersion</code>.</li><li>For any removed feature gates, add <code>&lt;new-version&gt;</code> as <code>RemovedInVersion</code> to the already existing feature gate in the map.</li><li>For feature gates locked to default, add <code>&lt;new-version&gt;</code> as <code>LockedToDefaultInVersion</code> and the corresponding <code>LockedValue</code> to the already existing feature gate in the map.</li><li>See <a href="https://github.com/gardener/gardener/pull/9689/commits" target="_blank" rel="noreferrer">this</a> example PR how it handles feature gate maintenance by using <code>compare-k8s-feature-gates.sh</code></li></ul></li><li>Maintain the Kubernetes <code>kube-apiserver</code> admission plugins used for validation of <code>Shoot</code> resources: <ul><li>The admission plugins are maintained in <a href="https://github.com/gardener/gardener/blob/master/pkg/utils/validation/admissionplugins/admissionplugins.go" target="_blank" rel="noreferrer">this</a> file.</li><li>See <a href="https://github.com/gardener/gardener/pull/11197/commits/116422c95d2c520629e3460376a69de97b5e3b1a" target="_blank" rel="noreferrer">this</a> and <a href="https://github.com/gardener/gardener/pull/9689/commits/94a1bf1bf0d6c0ffb7c59f87f1ccff1d6363ccc2" target="_blank" rel="noreferrer">this</a> example commit.</li><li>To maintain this list for new Kubernetes versions, run <code>hack/compare-k8s-admission-plugins.sh &lt;old-version&gt; &lt;new-version&gt;</code> (e.g. <code>hack/compare-k8s-admission-plugins.sh 1.26 1.27</code>).</li><li>It will present 2 lists of admission plugins: those added and those removed in <code>&lt;new-version&gt;</code> compared to <code>&lt;old-version&gt;</code>.</li><li>Add all added admission plugins to the <code>admissionPluginsVersionRanges</code> map with <code>&lt;new-version&gt;</code> as <code>AddedInVersion</code> and no <code>RemovedInVersion</code>. Set <code>AllowsConfiguration</code> to <code>true</code> when the new admission plugin allows configuration. To determine whether the admission plugin allows configuration, check the plugin&#39;s <code>Register()</code> method, whether it uses configuration or not. Be careful that functions that are called within the method can take the config as part of their signature, but ultimately do not use it. (<a href="https://github.com/kubernetes/kubernetes/blob/b346ac0f8e013cedb8d91b4065d385f84e81c43e/staging/src/k8s.io/apiserver/pkg/admission/plugin/resourcequota/admission.go#L47-L61" target="_blank" rel="noreferrer">ref (uses config)</a>, <a href="https://github.com/kubernetes/kubernetes/blob/61774cd7176cae0c0324d23ab20e6c6b3038153f/plugin/pkg/admission/storage/persistentvolume/resize/admission.go#L38-L43" target="_blank" rel="noreferrer">ref (does not use config)</a>)</li><li>For any removed admission plugins, add <code>&lt;new-version&gt;</code> as <code>RemovedInVersion</code> to the already existing admission plugin in the map.</li><li>In local setup, create a shoot with all of the newly added admission plugins disabled. Make sure that the shoot creation and deletion will succeed. If it fails, that means some of the admission plugins are required. Flag any admission plugins that are required (plugins that must not be disabled in the <code>Shoot</code> spec) by setting the <code>Required</code> boolean variable to true for the admission plugin in the map.</li><li>Check the <a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/" target="_blank" rel="noreferrer">Kubernetes documentation for admission controllers</a> if any newly added admission plugin is not recommended for production usage. Example: <code>The Kubernetes project recommends that you do not use the SecurityContextDeny admission controller</code>. Note that this admission controller was removed in Kubernetes 1.30 in <a href="https://github.com/gardener/gardener/pull/9689" target="_blank" rel="noreferrer">this PR</a> and that&#39;s why it is not mentioned in the latest Kubernetes documentation. Flag those admission plugins by setting the <code>Forbidden</code> boolean variable to true for the admission plugin in the map.</li></ul></li><li>Maintain the Kubernetes <code>kube-apiserver</code> API groups used for validation of <code>Shoot</code> resources: <ul><li>The API groups are maintained in <a href="https://github.com/gardener/gardener/blob/master/pkg/utils/validation/apigroups/apigroups.go" target="_blank" rel="noreferrer">this</a> file.</li><li>See <a href="https://github.com/gardener/gardener/pull/11197/commits/73b655475ac2565a9fdf098f10bab9cfdbed961a" target="_blank" rel="noreferrer">this</a> example commit.</li><li>To maintain this list for new Kubernetes versions, run <code>hack/compare-k8s-api-groups.sh &lt;old-version&gt; &lt;new-version&gt;</code> (e.g. <code>hack/compare-k8s-api-groups.sh 1.26 1.27</code>).</li><li>It will present 2 lists of API GroupVersions and 2 lists of API GroupVersionResources: those added and those removed in <code>&lt;new-version&gt;</code> compared to <code>&lt;old-version&gt;</code>.</li><li>Add all added group versions to the <code>apiGroupVersionRanges</code> map and group version resources to the <code>apiGVRVersionRanges</code> map with <code>&lt;new-version&gt;</code> as <code>AddedInVersion</code> and no <code>RemovedInVersion</code>.</li><li>For any removed APIs, add <code>&lt;new-version&gt;</code> as <code>RemovedInVersion</code> to the already existing API in the corresponding map.</li><li>In local setup, create a shoot and a workerless shoot with all of the newly added API groups disabled. Make sure that the shoot creation and deletion will succeed. If it fails, that means some of the API groups are required. Flag any APIs that are required (APIs that must not be disabled in the <code>Shoot</code> spec) by setting the <code>Required</code> boolean variable to true for the API in the <code>apiGVRVersionRanges</code> map. If this API also should not be disabled for <a href="/docs/gardener/shoot/shoot_workerless/">Workerless Shoots</a>, then set <code>RequiredForWorkerless</code> boolean variable also to true. If the API is required for both Shoot types, then both of these booleans need to be set to true. If the whole API Group is required, then mark it correspondingly in the <code>apiGroupVersionRanges</code> map.</li></ul></li><li>Maintain the Kubernetes <code>kube-controller-manager</code> controllers for each API group used in deploying required KCM controllers based on active APIs: <ul><li>The API groups are maintained in <a href="https://github.com/gardener/gardener/blob/master/pkg/utils/kubernetes/controllers.go" target="_blank" rel="noreferrer">this</a> file.</li><li>See <a href="https://github.com/gardener/gardener/pull/11197/commits/15f8ad3486edc629ecaaa5e30f10619737d01316" target="_blank" rel="noreferrer">this</a> example commit.</li><li>To maintain this list for new Kubernetes versions, run <code>hack/compute-k8s-controllers.sh &lt;old-version&gt; &lt;new-version&gt;</code> (e.g. <code>hack/compute-k8s-controllers.sh 1.28 1.29</code>).</li><li>If it complains that the path for the controller is not present in the map, check the release branch of the new Kubernetes version and find the correct path for the missing/wrong controller. You can do so by checking the file <code>cmd/kube-controller-manager/app/controllermanager.go</code> and where the controller is initialized from. As of now, there is no straight-forward way to map each controller to its file. If this has improved, please enhance the script.</li><li>If the paths are correct, it will present 2 lists of controllers: those added and those removed for each API group in <code>&lt;new-version&gt;</code> compared to <code>&lt;old-version&gt;</code>.</li><li>Add all added controllers to the <code>APIGroupControllerMap</code> map and under the corresponding API group with <code>&lt;new-version&gt;</code> as <code>AddedInVersion</code> and no <code>RemovedInVersion</code>.</li><li>For any removed controllers, add <code>&lt;new-version&gt;</code> as <code>RemovedInVersion</code> to the already existing controller in the corresponding API group map. If you are unable to find the removed controller name, then check for its alias. Either in the <code>staging/src/k8s.io/cloud-provider/names/controller_names.go</code> file (<a href="https://github.com/kubernetes/kubernetes/blob/9fd8f568fe06a154e15cd4919ad2a7f6c6917b9f/staging/src/k8s.io/cloud-provider/names/controller_names.go#L60" target="_blank" rel="noreferrer">example</a>) or in the <code>cmd/kube-controller-manager/app/*</code> files (<a href="https://github.com/kubernetes/kubernetes/blob/b584b87a94d6ff5256624bbf83dd5f758dff6eb2/cmd/kube-controller-manager/app/apps.go#L39" target="_blank" rel="noreferrer">example for apps API group</a>). This is because for kubernetes versions starting from <code>v1.28</code>, we don&#39;t maintain the aliases in the controller, but the controller names itself since some controllers can be initialized without aliases as well (<a href="https://github.com/kubernetes/kubernetes/blob/b584b87a94d6ff5256624bbf83dd5f758dff6eb2/cmd/kube-controller-manager/app/networking.go#L32-L39" target="_blank" rel="noreferrer">example</a>). The old alias should still be working since it should be backwards compatible as explained <a href="https://github.com/kubernetes/kubernetes/blob/9fd8f568fe06a154e15cd4919ad2a7f6c6917b9f/staging/src/k8s.io/cloud-provider/names/controller_names.go#L26-L31" target="_blank" rel="noreferrer">here</a>. Once the support for kubernetes version &lt; <code>v1.28</code> is dropped, we can drop the usages of these aliases and move completely to controller names.</li><li>Make sure that the API groups in <a href="https://github.com/gardener/gardener/blob/master/pkg/utils/validation/apigroups/apigroups.go" target="_blank" rel="noreferrer">this</a> file are in sync with the groups in <a href="https://github.com/gardener/gardener/blob/master/pkg/utils/kubernetes/controllers.go" target="_blank" rel="noreferrer">this</a> file. Please note that, for example, <code>core/v1</code> is replaced by the script as <code>v1</code> and <code>apiserverinternal</code> as <code>internal</code>. This is because the API groups registered by the apiserver (<a href="https://github.com/kubernetes/kubernetes/blob/8a9b209cb11943f4d53a0d840b55cf92ebfbe004/staging/src/k8s.io/api/apiserverinternal/v1alpha1/register.go#L26" target="_blank" rel="noreferrer">example</a>) and the file path imported by the controllers (<a href="https://github.com/kubernetes/kubernetes/blob/8a9b209cb11943f4d53a0d840b55cf92ebfbe004/pkg/controller/storageversiongc/gc_controller.go#L24" target="_blank" rel="noreferrer">example</a>) might be slightly different in some cases.</li></ul></li><li>Maintain the names of controllers used for workerless Shoots, <a href="https://github.com/gardener/gardener/blob/6988da80bae6ba827d63535655f28885d91b0a23/pkg/component/kubernetes/controllermanager/controllermanager.go#L744-L766" target="_blank" rel="noreferrer">here</a> after carefully evaluating whether they are needed if there are no workers. The Kubernetes documentation might not always explain what a specific controller does. In such cases, you may need to search the <a href="https://github.com/kubernetes/kubernetes" target="_blank" rel="noreferrer"><code>kubernetes/kubernetes</code></a> repository for the controller&#39;s name and find the pull request that introduced it.</li><li>Maintain copies of the <code>DaemonSet</code> controller&#39;s scheduling logic: <ul><li><code>gardener-resource-manager</code>&#39;s <a href="/docs/gardener/concepts/resource-manager/#node-controller"><code>Node</code> controller</a> uses a copy of parts of the <code>DaemonSet</code> controller&#39;s logic for determining whether a specific <code>Node</code> should run a daemon pod of a given <code>DaemonSet</code>: see <a href="https://github.com/gardener/gardener/blob/master/pkg/resourcemanager/controller/node/criticalcomponents/helper/daemon_controller.go" target="_blank" rel="noreferrer">this file</a>.</li><li>See <a href="https://github.com/gardener/gardener/pull/11197/commits/69f869e89425bc4709b0196b844e4916df6d3839" target="_blank" rel="noreferrer">this</a> example commit.</li><li>Check the referenced upstream files for changes to the <code>DaemonSet</code> controller&#39;s logic and adapt our copies accordingly. This might include introducing version-specific checks in our codebase to handle different shoot cluster versions.</li></ul></li><li>Handle breaking changes that require adjustments to update the Shoot to the new Kubernetes minor version: <ul><li>Removal of functionalities from the Shoot API is usually connected to a Kubernetes minor version upgrade. For more details, see the <a href="/docs/gardener/process/#deprecations-and-backwards-compatibility">Deprecations and Backwards-Compatibility section</a>. Check if there are breaking changes to the Shoot API that require the Shoot spec to be adapted in order to update to the new Kubernetes minor version.</li><li>Maintain version specific defaulting logic in shoot admission plugin. Sometimes default values for shoots are intentionally changed with the introduction of a new Kubernetes version. The final Kubernetes version for a shoot is determined in the <a href="https://github.com/gardener/gardener/blob/17dfefaffed6c5e125e35b6614c8dcad801839f1/plugin/pkg/shoot/validator/admission.go" target="_blank" rel="noreferrer">Shoot Validator Admission Plugin</a>. Any defaulting logic that depends on the version should be placed in this admission plugin (<a href="https://github.com/gardener/gardener/blob/f754c071e6cf8e45f7ac7bc5924acaf81b96dc06/plugin/pkg/shoot/validator/admission.go#L782" target="_blank" rel="noreferrer">example</a>).</li><li>Ensure that <a href="https://github.com/gardener/gardener/tree/master/pkg/controllermanager/controller/shoot/maintenance" target="_blank" rel="noreferrer">maintenance-controller</a> is able to auto-update shoots to the new Kubernetes version. Changes to the shoot spec required for the Kubernetes update should be enforced in such cases (<a href="https://github.com/gardener/gardener/blob/bdfc06dc5cb4e5764800fd31ba1dd07727ad78bf/pkg/controllermanager/controller/shoot/maintenance/reconciler.go#L146-L162" target="_blank" rel="noreferrer">examples</a>).</li><li>Maintain the <a href="/docs/gardener/shoot/shoot_kubernetes_versions/">Shoot Kubernetes Minor Version Upgrades</a> documentation file. Add breaking and/or behavioral changes related to Gardener, introduced with the new Kubernetes version.</li></ul></li><li>Add the new Kubernetes version to the CloudProfile in local setup. <ul><li>See <a href="https://github.com/gardener/gardener/pull/11197/commits/1b75c6e6e0c04a815819726750c8fc9c2727f42f" target="_blank" rel="noreferrer">this</a> example commit.</li></ul></li><li>In the next Gardener release, file a PR that bumps the used Kubernetes version for local e2e test. <ul><li>This step must be performed in a PR that targets the next Gardener release because of the e2e upgrade tests. The e2e upgrade tests deploy the previous Gardener version where the new Kubernetes version is not present in the CloudProfile. If the e2e tests are adapted in the same PR that adds the support for the Kubernetes version, then the e2e upgrade tests for that PR will fail because the newly added Kubernetes version in missing in the local CloudProfile from the old release.</li><li>See <a href="https://github.com/gardener/gardener/pull/9745" target="_blank" rel="noreferrer">this</a> example commit PR.</li></ul></li></ul><h4 id="filing-the-pull-request" tabindex="-1">Filing the Pull Request <a class="header-anchor" href="#filing-the-pull-request" aria-label="Permalink to &quot;Filing the Pull Request&quot;">​</a></h4><p>Work on all the tasks you have collected and validate them using the <a href="/docs/gardener/getting_started_locally/">local provider</a>. Execute the e2e tests and if everything looks good, then go ahead and file the PR (<a href="https://github.com/gardener/gardener/pull/5255" target="_blank" rel="noreferrer">example PR</a>). Generally, it is great if you add the PRs also to the umbrella issue so that they can be tracked more easily.</p><h3 id="adapting-provider-extensions" tabindex="-1">Adapting Provider Extensions <a class="header-anchor" href="#adapting-provider-extensions" aria-label="Permalink to &quot;Adapting Provider Extensions&quot;">​</a></h3><p>After the PR in <code>gardener/gardener</code> for the support of the new version has been merged, you can go ahead and work on the provider extensions.</p><blockquote><p>Actually, you can already start even if the PR is not yet merged and use the branch of your fork.</p></blockquote><ul><li>Update the <code>github.com/gardener/gardener</code> dependency in the extension and update the <code>README.md</code>.</li><li>Work on release-specific tasks related to this provider.</li></ul><h4 id="maintaining-the-cloud-controller-manager-images" tabindex="-1">Maintaining the <code>cloud-controller-manager</code> Images <a class="header-anchor" href="#maintaining-the-cloud-controller-manager-images" aria-label="Permalink to &quot;Maintaining the `cloud-controller-manager` Images&quot;">​</a></h4><p>Provider extensions are using upstream <code>cloud-controller-manager</code> images. Make sure to adopt the new <code>cloud-controller-manager</code> release for the new Kubernetes minor version (<a href="https://github.com/gardener/gardener-extension-provider-aws/pull/1055" target="_blank" rel="noreferrer">example PR</a>).</p><p>Some of the cloud providers are not using upstream <code>cloud-controller-manager</code> images for some of the supported Kubernetes versions. Instead, we build and maintain the images ourselves:</p><ul><li><a href="https://github.com/gardener/cloud-provider-gcp" target="_blank" rel="noreferrer">cloud-provider-gcp</a></li></ul><p>Use the instructions below in case you need to maintain a release branch for such <code>cloud-controller-manager</code> image:</p><details><summary>Expand the instructions!</summary><p>Until we switch to upstream images, you need to update the Kubernetes dependencies and release a new image. The required steps are as follows:</p><ul><li>Checkout the <code>legacy-cloud-provider</code> branch of the respective repository</li><li>Bump the versions in the <code>Dockerfile</code> (<a href="https://github.com/gardener/cloud-provider-gcp/commit/b7eb3f56b252aaf29adc78406672574b1bc17495" target="_blank" rel="noreferrer">example commit</a>).</li><li>Update the <code>VERSION</code> to <code>vX.Y.Z-dev</code> where <code>Z</code> is the latest available Kubernetes patch version for the <code>vX.Y</code> minor version.</li><li>Update the <code>k8s.io/*</code> dependencies in the <code>go.mod</code> file to <code>vX.Y.Z</code> and run <code>go mod tidy</code> (<a href="https://github.com/gardener/cloud-provider-gcp/commit/d41cc9f035bcc4893b40d90a4f617c4d436c5d62" target="_blank" rel="noreferrer">example commit</a>).</li><li>Checkout a new <code>release-vX.Y</code> branch and release it (<a href="https://github.com/gardener/cloud-provider-gcp/commits/release-v1.23" target="_blank" rel="noreferrer">example</a>)</li></ul><blockquote><p>As you are already on it, it is great if you also bump the <code>k8s.io/*</code> dependencies for the last three minor releases as well. In this case, you need to check out the <code>release-vX.{Y-{1,2,3}}</code> branches and only perform the last three steps (<a href="https://github.com/gardener/cloud-provider-gcp/commits/release-v1.20" target="_blank" rel="noreferrer">example branch</a>, <a href="https://github.com/gardener/cloud-provider-gcp/commit/372aa43fbacdeb76b3da9f6fad6cfd924d916227" target="_blank" rel="noreferrer">example commit</a>).</p></blockquote><p>Now you need to update the new releases in the <code>imagevector/images.yaml</code> of the respective provider extension so that they are used (see this <a href="https://github.com/gardener/gardener-extension-provider-aws/pull/942/commits/7e5c0d95ff95d65459d13ae7f79a030049322c71" target="_blank" rel="noreferrer">example commit</a> for reference).</p></details><h4 id="maintaining-additional-images" tabindex="-1">Maintaining Additional Images <a class="header-anchor" href="#maintaining-additional-images" aria-label="Permalink to &quot;Maintaining Additional Images&quot;">​</a></h4><p>Provider extensions might also deploy additional images other than <code>cloud-controller-manager</code> that are specific for a given Kubernetes minor version.</p><p>Make sure to use a new image for the following components:</p><ul><li><p>The <code>ecr-credential-provider</code> image for the provider-aws extension.</p><p>We are building the <code>ecr-credential-provider</code> image ourselves because the upstream community does not provide an OCI image for the corresponding component. For more details, see this <a href="https://github.com/kubernetes/cloud-provider-aws/issues/823" target="_blank" rel="noreferrer">upstream issue</a>.</p><p>Use the following steps to prepare a release of the <code>ecr-credential-provider</code> image for the new Kubernetes minor version:</p><ul><li>Update the <code>VERSION</code> file in the <a href="https://github.com/gardener/ecr-credential-provider" target="_blank" rel="noreferrer">gardener/ecr-credential-provider</a> repository (<a href="https://github.com/gardener/ecr-credential-provider/pull/2" target="_blank" rel="noreferrer">example PR</a>).</li><li>Once the PR is merged, trigger a new release from the CI/CD.</li></ul></li><li><p>The <code>csi-driver-cinder</code> and <code>csi-driver-manila</code> images for the provider-openstack extension.</p><p>The upstream community is providing <code>csi-driver-cinder</code> and <code>csi-driver-manila</code> releases per Kubernetes minor version. Make sure to adopt the new <code>csi-driver-cinder</code> and <code>csi-driver-manila</code> releases for the new Kubernetes minor version (<a href="https://github.com/gardener/gardener-extension-provider-openstack/pull/856" target="_blank" rel="noreferrer">example PR</a>).</p></li></ul><h4 id="filing-the-pull-request-1" tabindex="-1">Filing the Pull Request <a class="header-anchor" href="#filing-the-pull-request-1" aria-label="Permalink to &quot;Filing the Pull Request&quot;">​</a></h4><p>Again, work on all the tasks you have collected. This time, you cannot use the local provider for validation but should create real clusters on the various infrastructures. Typically, the following validations should be performed:</p><ul><li>Create new clusters with versions &lt; <code>vX.Y</code></li><li>Create new clusters with version = <code>vX.Y</code></li><li>Upgrade old clusters from version <code>vX.{Y-1}</code> to version <code>vX.Y</code></li><li>Delete clusters with versions &lt; <code>vX.Y</code></li><li>Delete clusters with version = <code>vX.Y</code></li></ul><p>If everything looks good, then go ahead and file the PR (<a href="https://github.com/gardener/gardener-extension-provider-aws/pull/480" target="_blank" rel="noreferrer">example PR</a>). Generally, it is again great if you add the PRs also to the umbrella issue so that they can be tracked more easily.</p><h3 id="bump-golang-dependencies-for-k8s-io-and-sigs-k8s-io-controller-runtime" tabindex="-1">Bump Golang dependencies for <code>k8s.io/*</code> and <code>sigs.k8s.io/controller-runtime</code> <a class="header-anchor" href="#bump-golang-dependencies-for-k8s-io-and-sigs-k8s-io-controller-runtime" aria-label="Permalink to &quot;Bump Golang dependencies for `k8s.io/*` and `sigs.k8s.io/controller-runtime`&quot;">​</a></h3><p>The versions of the upstream Go dependencies <code>k8s.io/*</code> and <code>sigs.k8s.io/controller-runtime</code> should be updated to the latest version that is compatible with the new Kubernetes version. This is handled via a separate issue (<a href="https://github.com/gardener/gardener/issues/11186" target="_blank" rel="noreferrer">example</a>) and pull request (<a href="https://github.com/gardener/gardener/pull/11418" target="_blank" rel="noreferrer">example</a>).</p><ul><li>Bump the <code>k8s.io/*</code> dependencies in the <code>go.mod</code> file to the latest version that is compatible with the new Kubernetes version.</li><li>Bump the <code>sigs.k8s.io/controller-runtime</code> dependency in the <code>go.mod</code> file to the latest version that is compatible with the new Kubernetes version. <ul><li>Ensure that the major version of <code>gomodules.xyz/jsonpatch/v2</code> that we use (<a href="https://github.com/gardener/gardener/blob/master/go.mod" target="_blank" rel="noreferrer">go.mod</a>) matches the major version of the same dependency in the updated version of <code>sigs.k8s.io/controller-runtime</code> (<a href="https://github.com/kubernetes-sigs/controller-runtime/blob/main/go.mod" target="_blank" rel="noreferrer">go.mod</a>).</li></ul></li></ul>',52)]))}const p=r(n,[["render",i]]);export{g as __pageData,p as default};
