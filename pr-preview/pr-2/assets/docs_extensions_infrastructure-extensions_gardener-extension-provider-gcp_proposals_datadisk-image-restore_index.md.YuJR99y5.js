import{_ as i,c as a,o as e,a2 as n}from"./chunks/framework.B8WFj13S.js";const c=JSON.parse('{"title":"Data Disk Restore From Image","description":"","frontmatter":{"authors":["@elankath"],"creation-date":"2025-04-05","github_repo":"https://github.com/gardener/gardener-extension-provider-gcp","github_subdir":"docs/proposals","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/extensions/infrastructure-extensions/gardener-extension-provider-gcp/proposals/datadisk-image-restore.md","to":"datadisk-image-restore.md"},"reviewers":["@rishabh-11","@unmarshall","@kon-angelo "],"status":"implementable","title":"Data Disk Restore From Image","prev":false,"next":false},"headers":[],"relativePath":"docs/extensions/infrastructure-extensions/gardener-extension-provider-gcp/proposals/datadisk-image-restore/index.md","filePath":"docs/extensions/infrastructure-extensions/gardener-extension-provider-gcp/proposals/datadisk-image-restore.md","lastUpdated":null}'),t={name:"docs/extensions/infrastructure-extensions/gardener-extension-provider-gcp/proposals/datadisk-image-restore/index.md"};function r(o,s,p,l,h,d){return e(),a("div",null,s[0]||(s[0]=[n(`<h1 id="data-disk-restore-from-image" tabindex="-1">Data Disk Restore From Image <a class="header-anchor" href="#data-disk-restore-from-image" aria-label="Permalink to &quot;Data Disk Restore From Image&quot;">​</a></h1><h2 id="table-of-contents" tabindex="-1">Table of Contents <a class="header-anchor" href="#table-of-contents" aria-label="Permalink to &quot;Table of Contents&quot;">​</a></h2><ul><li><a href="/documentation/pr-preview/pr-2/docs/extensions/infrastructure-extensions/gardener-extension-provider-gcp/proposals/datadisk-image-restore/#summary">Summary</a></li><li><a href="/documentation/pr-preview/pr-2/docs/extensions/infrastructure-extensions/gardener-extension-provider-gcp/proposals/datadisk-image-restore/#motivation">Motivation</a><ul><li><a href="/documentation/pr-preview/pr-2/docs/extensions/infrastructure-extensions/gardener-extension-provider-gcp/proposals/datadisk-image-restore/#goals">Goals</a></li><li><a href="/documentation/pr-preview/pr-2/docs/extensions/infrastructure-extensions/gardener-extension-provider-gcp/proposals/datadisk-image-restore/#non-goals">Non-Goals</a></li></ul></li><li><a href="/documentation/pr-preview/pr-2/docs/extensions/infrastructure-extensions/gardener-extension-provider-gcp/proposals/datadisk-image-restore/#proposal">Proposal</a></li><li><a href="/documentation/pr-preview/pr-2/docs/extensions/infrastructure-extensions/gardener-extension-provider-gcp/proposals/datadisk-image-restore/#alternatives">Alternatives</a></li></ul><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><p>Currently, we have no support either in the shoot spec or in the <a href="https://github.com/gardener/machine-controller-manager-provider-gcp" target="_blank" rel="noreferrer">MCM GCP Provider</a> for restoring GCP Data Disks from images.</p><h2 id="motivation" tabindex="-1">Motivation <a class="header-anchor" href="#motivation" aria-label="Permalink to &quot;Motivation&quot;">​</a></h2><p>The primary motivation is to support <a href="https://github.com/gardener/gardener-extension-provider-azure/issues/788" target="_blank" rel="noreferrer">Integration of vSMP MemeoryOne in Azure</a>. We implemented support for this in AWS via <a href="https://github.com/gardener/gardener-extension-provider-aws/pull/112" target="_blank" rel="noreferrer">Support for data volume snapshot ID </a>. In GCP we have the option to restore data disk from a custom image which is more convenient and flexible.</p><h3 id="goals" tabindex="-1">Goals <a class="header-anchor" href="#goals" aria-label="Permalink to &quot;Goals&quot;">​</a></h3><ol><li>Extend the GCP provider specific <a href="/documentation/pr-preview/pr-2/docs/extensions/infrastructure-extensions/gardener-extension-provider-gcp/usage/">WorkerConfig</a> section in the shoot YAML and support provider configuration for data-disks to support data-disk creation from an image name by supplying an image name.</li></ol><h2 id="proposal" tabindex="-1">Proposal <a class="header-anchor" href="#proposal" aria-label="Permalink to &quot;Proposal&quot;">​</a></h2><h3 id="shoot-specification" tabindex="-1">Shoot Specification <a class="header-anchor" href="#shoot-specification" aria-label="Permalink to &quot;Shoot Specification&quot;">​</a></h3><p>At this current time, there is no support for provider specific configuration of data disks in an GCP shoot spec. The below shows an example configuration at the time of this proposal:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">providerConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gcp.provider.extensions.gardener.cloud/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">WorkerConfig</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  volume</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    interface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">NVME</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    encryption</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># optional, skipped detail here</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  serviceAccount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    email</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">foo@bar.com</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    scopes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://www.googleapis.com/auth/cloud-platform</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  gpu</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    acceleratorType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nvidia-tesla-t4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span></code></pre></div><p>We propose that the worker config section be enahnced to support data disk configuration</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">providerConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gcp.provider.extensions.gardener.cloud/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">WorkerConfig</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  volume</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    interface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">NVME</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    encryption</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># optional, skipped detail here</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  dataVolumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;-- NEW SUB_SECTION</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">vsmp1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">imgName</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  serviceAccount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    email</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">foo@bar.com</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    scopes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://www.googleapis.com/auth/cloud-platform</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  gpu</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    acceleratorType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nvidia-tesla-t4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span></code></pre></div><p>In the above <code>imgName</code> specified in <code>providerConfig.dataVolumes.image</code> represents the image name of a previously created image created by a tool or process. See <a href="https://cloud.google.com/sdk/gcloud/reference/compute/images/create" target="_blank" rel="noreferrer">Google Cloud Create Image</a>.</p><p>The <a href="https://github.com/gardener/machine-controller-manager-provider-gcp" target="_blank" rel="noreferrer">MCM GCP Provider</a> will ensure when a VM instance is instantiated, that the data disk(s) for the VM are created with the <em>source image</em> set to the provided <code>imgName</code>. The mechanics of this is left to MCM GCP provider. See <code>image</code> param to <code>--create-disk</code> flag in <a href="https://cloud.google.com/sdk/gcloud/reference/compute/instances/create" target="_blank" rel="noreferrer">Google Cloud Instance Creation</a></p>`,17)]))}const g=i(t,[["render",r]]);export{c as __pageData,g as default};
