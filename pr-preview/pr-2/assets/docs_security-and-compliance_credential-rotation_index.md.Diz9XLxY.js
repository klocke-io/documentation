import{_ as t,a,b as s,c as i}from"./chunks/user-provided-keys.n4WqbohX.js";import{_ as r,c as n,o,a2 as l}from"./chunks/framework.Bfq10Vlj.js";const b=JSON.parse('{"title":"Credential Rotation","description":"","frontmatter":{"github_repo":"https://github.com/gardener/documentation","github_subdir":"website/documentation/getting-started/features","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/security-and-compliance/credential-rotation.md","to":"credential-rotation.md"},"title":"Credential Rotation","weight":37,"prev":false,"next":false},"headers":[],"relativePath":"docs/security-and-compliance/credential-rotation/index.md","filePath":"docs/security-and-compliance/credential-rotation.md","lastUpdated":null}'),h={name:"docs/security-and-compliance/credential-rotation/index.md"};function d(p,e,c,k,u,g){return o(),n("div",null,e[0]||(e[0]=[l('<h1 id="credential-rotation" tabindex="-1">Credential Rotation <a class="header-anchor" href="#credential-rotation" aria-label="Permalink to &quot;Credential Rotation&quot;">​</a></h1><h2 id="keys" tabindex="-1">Keys <a class="header-anchor" href="#keys" aria-label="Permalink to &quot;Keys&quot;">​</a></h2><p>There are plenty of keys in Gardener. The ETCD needs one to store resources like secrets encrypted at rest. Gardener generates certificate authorities (CAs) to ensure secured communication between the various components and actors and service account tokens are signed with a dedicated key. There is also an SSH key pair to allow debugging of nodes and the observability stack has its own passwords too.</p><p><img src="'+t+'" alt="keys"></p><p>All of these keys share a common property: they are managed by Gardener. Rotating them, however, is potentially very disruptive. Hence, Gardener does not do it automatically, but offers you means to perform these tasks easily. For a single cluster, you may conveniently use the dashboard.</p><p><img src="'+a+'" alt="Prepare the rotation of all credentials from the Gardener dashboard"></p><p>Where possible, the rotation happens in two phases - Preparing and Completing.</p><h3 id="prepare-rotation-of-all-credentials" tabindex="-1">Prepare Rotation of All Credentials <a class="header-anchor" href="#prepare-rotation-of-all-credentials" aria-label="Permalink to &quot;Prepare Rotation of All Credentials&quot;">​</a></h3><p>The Preparing phase introduces new keys while the old ones are still valid. Users can safely exchange keys / CA bundles wherever they are used. It is possible to start the preparation by annotating the shoot resource accordingly:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shoot-namespac</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shoot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shoot-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardener.cloud/operation=rotate-credentials-start</span></span></code></pre></div><h3 id="complete-rotation-of-all-credentials" tabindex="-1">Complete Rotation of All Credentials <a class="header-anchor" href="#complete-rotation-of-all-credentials" aria-label="Permalink to &quot;Complete Rotation of All Credentials&quot;">​</a></h3><p>Afterward, the Completing phase will invalidate the old keys / CA bundles. Annotate the shoot resource accordingly:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shoot-namespac</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shoot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shoot-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gardener.cloud/operation=rotate-credentials-complete</span></span></code></pre></div><h2 id="rotation-phases" tabindex="-1">Rotation Phases <a class="header-anchor" href="#rotation-phases" aria-label="Permalink to &quot;Rotation Phases&quot;">​</a></h2><p><img src="'+s+'" alt="rotation-phases"></p><p>At the beginning, only the old set of credentials exists. By triggering the rotation, new credentials are created in the Preparing phase and both sets are valid. Now, all clients have to update and start using the new credentials. Only afterward it is safe to trigger the Completing phase, which invalidates the old credentials.</p><p>The shoot&#39;s status will always show the current status / phase of the rotation.</p><p>For more information, see <a href="/docs/gardener/shoot-operations/shoot_credentials_rotation/">Credentials Rotation for Shoot Clusters</a>.</p><h2 id="user-provided-credentials" tabindex="-1">User-Provided Credentials <a class="header-anchor" href="#user-provided-credentials" aria-label="Permalink to &quot;User-Provided Credentials&quot;">​</a></h2><p><img src="'+i+'" alt="user-provided-keys"></p><p>You grant Gardener permissions to create resources by handing over cloud provider keys. These keys are stored in a secret and referenced to a shoot via a SecretBinding. Gardener uses the keys to create the network for the cluster resources, routes, VMs, disks, and IP addresses.</p><p>When you rotate credentials, the new keys have to be stored in the same secret and the shoot needs to reconcile successfully to ensure the replication to every controller. Afterward, the old keys can be deleted safely from Gardener&#39;s perspective.</p><p>While the reconciliation can be triggered manually, there is no need for it (if you&#39;re not in a hurry). Each shoot reconciles once within 24h and the new keys will be picked up during the next maintenance window.</p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>It is not possible to move a shoot to a different infrastructure account (at all!).</p></div>',24)]))}const f=r(h,[["render",d]]);export{b as __pageData,f as default};
