import{_ as n,c as i,o as s,a2 as a}from"./chunks/framework.B8WFj13S.js";const u=JSON.parse('{"title":"ContainerRuntime","description":"","frontmatter":{"github_repo":"https://github.com/gardener/gardener","github_subdir":"docs/extensions/resources","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/gardener/extensions/resources/containerruntime.md","to":"containerruntime.md"},"title":"ContainerRuntime","prev":false,"next":false},"headers":[],"relativePath":"docs/gardener/extensions/resources/containerruntime/index.md","filePath":"docs/gardener/extensions/resources/containerruntime.md","lastUpdated":null}'),t={name:"docs/gardener/extensions/resources/containerruntime/index.md"};function r(o,e,c,l,d,h){return s(),i("div",null,e[0]||(e[0]=[a(`<h1 id="contract-containerruntime-resource" tabindex="-1">Contract: <code>ContainerRuntime</code> Resource <a class="header-anchor" href="#contract-containerruntime-resource" aria-label="Permalink to &quot;Contract: \`ContainerRuntime\` Resource&quot;">​</a></h1><p>At the lowest layers of a Kubernetes node is the software that, among other things, starts and stops containers. It is called “Container Runtime”. The most widely known container runtime is Docker, but it is not alone in this space. In fact, the container runtime space has been rapidly evolving.</p><p>Kubernetes supports different container runtimes using Container Runtime Interface (CRI) – a plugin interface which enables kubelet to use a wide variety of container runtimes.</p><p>Gardener supports creation of Worker machines using CRI. For more information, see <a href="/documentation/pr-preview/pr-2/docs/gardener/extensions/resources/operatingsystemconfig/#cri-support">CRI Support</a>.</p><h2 id="motivation" tabindex="-1">Motivation <a class="header-anchor" href="#motivation" aria-label="Permalink to &quot;Motivation&quot;">​</a></h2><p>Prior to the <code>Container Runtime Extensibility</code> concept, Gardener used Docker as the only container runtime to use in shoot worker machines. Because of the wide variety of different container runtimes offering multiple important features (for example, enhanced security concepts), it is important to enable end users to use other container runtimes as well.</p><h2 id="the-containerruntime-extension-resource" tabindex="-1">The <code>ContainerRuntime</code> Extension Resource <a class="header-anchor" href="#the-containerruntime-extension-resource" aria-label="Permalink to &quot;The \`ContainerRuntime\` Extension Resource&quot;">​</a></h2><p>Here is what a typical <code>ContainerRuntime</code> resource would look like:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">extensions.gardener.cloud/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ContainerRuntime</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-container-runtime</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  binaryPath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/var/bin/containerruntimes</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gvisor</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  workerPool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">worker-ubuntu</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        worker.gardener.cloud/pool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">worker-ubuntu</span></span></code></pre></div><p>Gardener deploys one <code>ContainerRuntime</code> resource per worker pool per CRI. To exemplify this, consider a Shoot having two worker pools (<code>worker-one</code>, <code>worker-two</code>) using <code>containerd</code> as the CRI as well as <code>gvisor</code> and <code>kata</code> as enabled container runtimes. Gardener would deploy four <code>ContainerRuntime</code> resources. For <code>worker-one</code>: one <code>ContainerRuntime</code> for type <code>gvisor</code> and one for type <code>kata</code>. The same resource are being deployed for <code>worker-two</code>.</p><h2 id="supporting-a-new-container-runtime-provider" tabindex="-1">Supporting a New Container Runtime Provider <a class="header-anchor" href="#supporting-a-new-container-runtime-provider" aria-label="Permalink to &quot;Supporting a New Container Runtime Provider&quot;">​</a></h2><p>To add support for another container runtime (e.g., gvisor, kata-containers), a container runtime extension controller needs to be implemented. It should support Gardener&#39;s supported CRI plugins.</p><p>The container runtime extension should install the necessary resources into the shoot cluster (e.g., <code>RuntimeClass</code>es), and it should copy the runtime binaries to the relevant worker machines in path: <code>spec.binaryPath</code>. Gardener labels the shoot nodes according to the CRI configured: <code>worker.gardener.cloud/cri-name=&lt;value&gt;</code> (e.g., <code>worker.gardener.cloud/cri-name=containerd</code>) and multiple labels for each of the container runtimes configured for the shoot Worker machine: <code>containerruntime.worker.gardener.cloud/&lt;container-runtime-type-value&gt;=true</code> (e.g., <code>containerruntime.worker.gardener.cloud/gvisor=true</code>). The way to install the binaries is by creating a daemon set which copies the binaries from an image in a docker registry to the relevant labeled Worker&#39;s nodes (avoid downloading binaries from the internet to also cater with isolated environments).</p><p>For additional reference, please have a look at the <a href="https://github.com/gardener/gardener-extension-runtime-gvisor" target="_blank" rel="noreferrer">runtime-gvsior</a> provider extension, which provides more information on how to configure the necessary charts, as well as the actuators required to reconcile container runtime inside the <code>Shoot</code> cluster to the desired state.</p>`,14)]))}const k=n(t,[["render",r]]);export{u as __pageData,k as default};
