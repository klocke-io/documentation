import{_ as o,c as s,o as t,a2 as a}from"./chunks/framework.B8WFj13S.js";const p=JSON.parse('{"title":"Monitoring","description":"","frontmatter":{"github_repo":"https://github.com/gardener/gardener-extension-shoot-rsyslog-relp","github_subdir":"docs/usage","params":{"github_branch":"main"},"path_base_for_github_subdir":{"from":"content/docs/extensions/others/gardener-extension-shoot-rsyslog-relp/monitoring.md","to":"monitoring.md"},"persona":"Users","title":"Monitoring","prev":false,"next":false},"headers":[],"relativePath":"docs/extensions/others/gardener-extension-shoot-rsyslog-relp/monitoring/index.md","filePath":"docs/extensions/others/gardener-extension-shoot-rsyslog-relp/monitoring.md","lastUpdated":null}'),r={name:"docs/extensions/others/gardener-extension-shoot-rsyslog-relp/monitoring/index.md"};function l(i,e,n,d,c,u){return t(),s("div",null,e[0]||(e[0]=[a('<h1 id="monitoring" tabindex="-1">Monitoring <a class="header-anchor" href="#monitoring" aria-label="Permalink to &quot;Monitoring&quot;">​</a></h1><p>The <code>shoot-rsyslog-relp</code> extension exposes metrics for the <code>rsyslog</code> service running on a Shoot&#39;s nodes so that they can be easily viewed by cluster owners and operators in the Shoot&#39;s Prometheus and Plutono instances. The exposed monitoring data offers valuable insights into the operation of the <code>rsyslog</code> service and can be used to detect and debug ongoing issues. This guide describes the various metrics, alerts and logs available to cluster owners and operators.</p><h2 id="metrics" tabindex="-1">Metrics <a class="header-anchor" href="#metrics" aria-label="Permalink to &quot;Metrics&quot;">​</a></h2><p>Metrics for the <code>rsyslog</code> service originate from its <code>impstats</code> module. These include the number of messages in the various queues, the number of ingested messages, the number of processed messages by configured actions, system resources used by the <code>rsyslog</code> service, and others. More information about them can be found in the <a href="https://www.rsyslog.com/doc/configuration/modules/impstats.html" target="_blank" rel="noreferrer"><code>impstats</code> documentation</a> and the <a href="https://www.rsyslog.com/doc/configuration/rsyslog_statistic_counter.html" target="_blank" rel="noreferrer">statistics counter documentation</a>. They are exposed via the <a href="https://github.com/prometheus/node_exporter?tab=readme-ov-file#node-exporter" target="_blank" rel="noreferrer"><code>node-exporter</code></a> running on each Shoot node and are scraped by the Shoot&#39;s <a href="https://github.com/gardener/gardener/blob/release-v1.99/docs/monitoring/README.md#shoot-prometheus" target="_blank" rel="noreferrer">Prometheus instance</a>.</p><p>These metrics can also be viewed in a dedicated dashboard named <code>Rsyslog Stats</code> in the Shoot&#39;s Plutono instance. You can select the node for which you wish the metrics to be displayed from the <code>Node</code> dropdown menu (by default metrics are summed over all nodes).</p><p>Following is a list of all exposed <code>rsyslog</code> metrics. The <code>name</code> and <code>origin</code> labels can be used to determine wether the metric is for: a <a href="https://www.rsyslog.com/doc/configuration/rsyslog_statistic_counter.html#queue" target="_blank" rel="noreferrer">queue</a>, an <a href="https://www.rsyslog.com/doc/configuration/rsyslog_statistic_counter.html#queue" target="_blank" rel="noreferrer">action</a>, <a href="https://www.rsyslog.com/doc/configuration/rsyslog_statistic_counter.html#plugins" target="_blank" rel="noreferrer">plugins</a> or <a href="https://www.rsyslog.com/doc/configuration/modules/impstats.html#statistic-counter" target="_blank" rel="noreferrer">system stats</a>; the <code>node</code> label can be used to determine the node the metric originates from:</p><h4 id="rsyslog-pstat-submitted" tabindex="-1">rsyslog_pstat_submitted <a class="header-anchor" href="#rsyslog-pstat-submitted" aria-label="Permalink to &quot;rsyslog_pstat_submitted&quot;">​</a></h4><p>Number of messages that were submitted to the <code>rsyslog</code> service from its input. Currently <code>rsyslog</code> uses the <code>/run/systemd/journal/syslog</code> socket as input.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-processed" tabindex="-1">rsyslog_pstat_processed <a class="header-anchor" href="#rsyslog-pstat-processed" aria-label="Permalink to &quot;rsyslog_pstat_processed&quot;">​</a></h4><p>Number of messages that are successfully processed by an action and sent to the target server.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-failed" tabindex="-1">rsyslog_pstat_failed <a class="header-anchor" href="#rsyslog-pstat-failed" aria-label="Permalink to &quot;rsyslog_pstat_failed&quot;">​</a></h4><p>Number of messages that could not be processed by an action nor sent to the target server.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-suspended" tabindex="-1">rsyslog_pstat_suspended <a class="header-anchor" href="#rsyslog-pstat-suspended" aria-label="Permalink to &quot;rsyslog_pstat_suspended&quot;">​</a></h4><p>Total number of times an action suspended itself. Note that this counts the number of times the action transitioned from active to suspended state. The counter is no indication of how long the action was suspended or how often it was retried.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-suspended-duration" tabindex="-1">rsyslog_pstat_suspended_duration <a class="header-anchor" href="#rsyslog-pstat-suspended-duration" aria-label="Permalink to &quot;rsyslog_pstat_suspended_duration&quot;">​</a></h4><p>The total number of seconds this action was disabled.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-resumed" tabindex="-1">rsyslog_pstat_resumed <a class="header-anchor" href="#rsyslog-pstat-resumed" aria-label="Permalink to &quot;rsyslog_pstat_resumed&quot;">​</a></h4><p>The total number of times this action resumed itself. A resumption occurs after the action has detected that a failure condition does no longer exist.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-utime" tabindex="-1">rsyslog_pstat_utime <a class="header-anchor" href="#rsyslog-pstat-utime" aria-label="Permalink to &quot;rsyslog_pstat_utime&quot;">​</a></h4><p>User time used in microseconds.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-stime" tabindex="-1">rsyslog_pstat_stime <a class="header-anchor" href="#rsyslog-pstat-stime" aria-label="Permalink to &quot;rsyslog_pstat_stime&quot;">​</a></h4><p>System time used in microsends.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-maxrss" tabindex="-1">rsyslog_pstat_maxrss <a class="header-anchor" href="#rsyslog-pstat-maxrss" aria-label="Permalink to &quot;rsyslog_pstat_maxrss&quot;">​</a></h4><p>Maximum resident set size</p><ul><li>Type: Gauge</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-minflt" tabindex="-1">rsyslog_pstat_minflt <a class="header-anchor" href="#rsyslog-pstat-minflt" aria-label="Permalink to &quot;rsyslog_pstat_minflt&quot;">​</a></h4><p>Total number of minor faults the task has made per second, those which have not required loading a memory page from disk.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-majflt" tabindex="-1">rsyslog_pstat_majflt <a class="header-anchor" href="#rsyslog-pstat-majflt" aria-label="Permalink to &quot;rsyslog_pstat_majflt&quot;">​</a></h4><p>Total number of major faults the task has made per second, those which have required loading a memory page from disk.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-inblock" tabindex="-1">rsyslog_pstat_inblock <a class="header-anchor" href="#rsyslog-pstat-inblock" aria-label="Permalink to &quot;rsyslog_pstat_inblock&quot;">​</a></h4><p>Filesystem input operations.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-oublock" tabindex="-1">rsyslog_pstat_oublock <a class="header-anchor" href="#rsyslog-pstat-oublock" aria-label="Permalink to &quot;rsyslog_pstat_oublock&quot;">​</a></h4><p>Filesystem output operations.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-nvcsw" tabindex="-1">rsyslog_pstat_nvcsw <a class="header-anchor" href="#rsyslog-pstat-nvcsw" aria-label="Permalink to &quot;rsyslog_pstat_nvcsw&quot;">​</a></h4><p>Voluntary context switches.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-nivcsw" tabindex="-1">rsyslog_pstat_nivcsw <a class="header-anchor" href="#rsyslog-pstat-nivcsw" aria-label="Permalink to &quot;rsyslog_pstat_nivcsw&quot;">​</a></h4><p>Involuntary context switches.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-openfiles" tabindex="-1">rsyslog_pstat_openfiles <a class="header-anchor" href="#rsyslog-pstat-openfiles" aria-label="Permalink to &quot;rsyslog_pstat_openfiles&quot;">​</a></h4><p>Number of open files.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-size" tabindex="-1">rsyslog_pstat_size <a class="header-anchor" href="#rsyslog-pstat-size" aria-label="Permalink to &quot;rsyslog_pstat_size&quot;">​</a></h4><p>Messages currently in queue.</p><ul><li>Type: Gauge</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-enqueued" tabindex="-1">rsyslog_pstat_enqueued <a class="header-anchor" href="#rsyslog-pstat-enqueued" aria-label="Permalink to &quot;rsyslog_pstat_enqueued&quot;">​</a></h4><p>Total messages enqueued.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-full" tabindex="-1">rsyslog_pstat_full <a class="header-anchor" href="#rsyslog-pstat-full" aria-label="Permalink to &quot;rsyslog_pstat_full&quot;">​</a></h4><p>Times queue was full.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-discarded-full" tabindex="-1">rsyslog_pstat_discarded_full <a class="header-anchor" href="#rsyslog-pstat-discarded-full" aria-label="Permalink to &quot;rsyslog_pstat_discarded_full&quot;">​</a></h4><p>Messages discarded due to queue being full.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-discarded-nf" tabindex="-1">rsyslog_pstat_discarded_nf <a class="header-anchor" href="#rsyslog-pstat-discarded-nf" aria-label="Permalink to &quot;rsyslog_pstat_discarded_nf&quot;">​</a></h4><p>Messages discarded when queue not full.</p><ul><li>Type: Counter</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-pstat-maxqsize" tabindex="-1">rsyslog_pstat_maxqsize <a class="header-anchor" href="#rsyslog-pstat-maxqsize" aria-label="Permalink to &quot;rsyslog_pstat_maxqsize&quot;">​</a></h4><p>Maximum size queue has reached.</p><ul><li>Type: Gauge</li><li>Labels: <code>name</code> <code>node</code> <code>origin</code></li></ul><h4 id="rsyslog-augenrules-load-success" tabindex="-1">rsyslog_augenrules_load_success <a class="header-anchor" href="#rsyslog-augenrules-load-success" aria-label="Permalink to &quot;rsyslog_augenrules_load_success&quot;">​</a></h4><p>Shows whether the <code>augenrules --load</code> command was executed successfully or not on the node.</p><ul><li>Type: Gauge</li><li>Labels: <code>node</code></li></ul><h2 id="alerts" tabindex="-1">Alerts <a class="header-anchor" href="#alerts" aria-label="Permalink to &quot;Alerts&quot;">​</a></h2><p>There are three alerts defined for the <code>rsyslog</code> service in the Shoot&#39;s Prometheus instance:</p><h4 id="rsyslogtoomanyrelpactionfailures" tabindex="-1">RsyslogTooManyRelpActionFailures <a class="header-anchor" href="#rsyslogtoomanyrelpactionfailures" aria-label="Permalink to &quot;RsyslogTooManyRelpActionFailures&quot;">​</a></h4><p>This indicates that the cumulative failure rate in processing <code>relp</code> action messages is greater than 2%. In other words, it compares the rate of processed <code>relp</code> action messages to the rate of failed <code>relp</code> action messages and fires an alert when the following expression evaluates to true:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sum(rate(rsyslog_pstat_failed{origin=&quot;core.action&quot;,name=&quot;rsyslg-relp&quot;}[5m])) / sum(rate(rsyslog_pstat_processed{origin=&quot;core.action&quot;,name=&quot;rsyslog-relp&quot;}[5m])) &gt; bool 0.02`</span></span></code></pre></div><h4 id="rsyslogrelpactionprocessingrateiszero" tabindex="-1">RsyslogRelpActionProcessingRateIsZero <a class="header-anchor" href="#rsyslogrelpactionprocessingrateiszero" aria-label="Permalink to &quot;RsyslogRelpActionProcessingRateIsZero&quot;">​</a></h4><p>This indicates that no messages are being sent to the upstream rsyslog target by the <code>relp</code> action. An alert is fired when the following expression evaluates to true:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>rate(rsyslog_pstat_processed{origin=&quot;core.action&quot;,name=&quot;rsyslog-relp&quot;}[5m]) == 0</span></span></code></pre></div><h4 id="rsyslogrelpauditrulesnotloadedsuccessfully" tabindex="-1">RsyslogRelpAuditRulesNotLoadedSuccessfully <a class="header-anchor" href="#rsyslogrelpauditrulesnotloadedsuccessfully" aria-label="Permalink to &quot;RsyslogRelpAuditRulesNotLoadedSuccessfully&quot;">​</a></h4><p>This indicates that <code>augenrules --load</code> was not executed successfully when called to load the configured audit rules. You should check if the <code>auditd</code> configuration you provided is valid. An alert is fired when the following expression evaluates to true:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>absent(rsyslog_augenrules_load_success == 1)</span></span></code></pre></div><p>Users can subscribe to these alerts by following the Gardener <a href="/documentation/pr-preview/pr-2/docs/gardener/monitoring/alerting/#alerting-for-users">alerting guide</a>.</p><h2 id="logging" tabindex="-1">Logging <a class="header-anchor" href="#logging" aria-label="Permalink to &quot;Logging&quot;">​</a></h2><p>There are two ways to view the logs of the <code>rsyslog</code> service running on the Shoot&#39;s nodes - either using the <code>Explore</code> tab of the Shoot&#39;s Plutono instance, or <code>ssh</code>-ing directly to a node.</p><p>To view logs in Plutono, navigate to the <code>Explore</code> tab and select <code>vali</code> from the <code>Explore</code> dropdown menu. Afterwards enter the following <code>vali</code> query:</p><p><code>{nodename=&quot;&lt;name-of-node&gt;&quot;} |~ &quot;\\&quot;unit\\&quot;:\\&quot;rsyslog.service\\&quot;&quot;</code></p><p>Notice that you cannot use the <code>unit</code> label to filter for the <code>rsyslog.service</code> unit logs. Instead, you have to <code>grep</code> for the service as displayed in the example above.</p><p>To view logs when directly <code>ssh</code>-ing to a node in the Shoot cluster, use either of the following commands on the node:</p><p><code>systemctl status rsyslog</code></p><p><code>journalctl -u rsyslog</code></p>',95)]))}const g=o(r,[["render",l]]);export{p as __pageData,g as default};
