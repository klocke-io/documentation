import{_ as i,c as a,o as e,a2 as n}from"./chunks/framework.Bfq10Vlj.js";const c=JSON.parse('{"title":"Machine Deployment","description":"","frontmatter":{"github_repo":"https://github.com/gardener/machine-controller-manager","github_subdir":"docs/operations","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/other-components/machine-controller-manager/machine_deployment.md","to":"machine_deployment.md"},"persona":"Operators","title":"Machine Deployment","prev":false,"next":false},"headers":[],"relativePath":"docs/other-components/machine-controller-manager/machine_deployment/index.md","filePath":"docs/other-components/machine-controller-manager/machine_deployment.md","lastUpdated":null}'),t={name:"docs/other-components/machine-controller-manager/machine_deployment/index.md"};function l(h,s,p,k,o,r){return e(),a("div",null,s[0]||(s[0]=[n(`<h1 id="maintaining-machine-replicas-using-machines-deployments" tabindex="-1">Maintaining machine replicas using machines-deployments <a class="header-anchor" href="#maintaining-machine-replicas-using-machines-deployments" aria-label="Permalink to &quot;Maintaining machine replicas using machines-deployments&quot;">​</a></h1><ul><li><a href="/docs/other-components/machine-controller-manager/machine_deployment/#maintaining-machine-replicas-using-machines-deployments">Maintaining machine replicas using machines-deployments</a><ul><li><a href="/docs/other-components/machine-controller-manager/machine_deployment/#setting-up-your-usage-environment">Setting up your usage environment</a><ul><li><a href="/docs/other-components/machine-controller-manager/machine_deployment/#important-warning">Important ⚠️</a></li></ul></li><li><a href="/docs/other-components/machine-controller-manager/machine_deployment/#creating-machine-deployment">Creating machine-deployment</a></li><li><a href="/docs/other-components/machine-controller-manager/machine_deployment/#inspect-status-of-machine-deployment">Inspect status of machine-deployment</a></li><li><a href="/docs/other-components/machine-controller-manager/machine_deployment/#health-monitoring">Health monitoring</a></li><li><a href="/docs/other-components/machine-controller-manager/machine_deployment/#update-your-machines">Update your machines</a><ul><li><a href="/docs/other-components/machine-controller-manager/machine_deployment/#inspect-existing-cluster-configuration">Inspect existing cluster configuration</a></li><li><a href="/docs/other-components/machine-controller-manager/machine_deployment/#perform-a-rolling-update">Perform a rolling update</a></li><li><a href="/docs/other-components/machine-controller-manager/machine_deployment/#re-check-cluster-configuration">Re-check cluster configuration</a></li><li><a href="/docs/other-components/machine-controller-manager/machine_deployment/#more-variants-of-updates">More variants of updates</a></li></ul></li><li><a href="/docs/other-components/machine-controller-manager/machine_deployment/#undo-an-update">Undo an update</a></li><li><a href="/docs/other-components/machine-controller-manager/machine_deployment/#pause-an-update">Pause an update</a></li><li><a href="/docs/other-components/machine-controller-manager/machine_deployment/#delete-machine-deployment">Delete machine-deployment</a></li></ul></li></ul><h2 id="setting-up-your-usage-environment" tabindex="-1">Setting up your usage environment <a class="header-anchor" href="#setting-up-your-usage-environment" aria-label="Permalink to &quot;Setting up your usage environment&quot;">​</a></h2><p>Follow the <a href="/docs/other-components/machine-controller-manager/prerequisite/">steps described here</a></p><h3 id="important" tabindex="-1">Important ⚠️ <a class="header-anchor" href="#important" aria-label="Permalink to &quot;Important :warning:&quot;">​</a></h3><blockquote><p>Make sure that the <code>kubernetes/machine_objects/machine-deployment.yaml</code> points to the same class name as the <code>kubernetes/machine_classes/aws-machine-class.yaml</code>.</p></blockquote><blockquote><p>Similarly <code>kubernetes/machine_classes/aws-machine-class.yaml</code> secret name and namespace should be same as that mentioned in <code>kubernetes/secrets/aws-secret.yaml</code></p></blockquote><h2 id="creating-machine-deployment" tabindex="-1">Creating machine-deployment <a class="header-anchor" href="#creating-machine-deployment" aria-label="Permalink to &quot;Creating machine-deployment&quot;">​</a></h2><ul><li>Modify <code>kubernetes/machine_objects/machine-deployment.yaml</code> as per your requirement. Modify the number of replicas to the desired number of machines. Then, create an machine-deployment.</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes/machine_objects/machine-deployment.yaml</span></span></code></pre></div><p>Now the Machine Controller Manager picks up the manifest immediately and starts to create a new machines based on the number of replicas you have provided in the manifest.</p><ul><li>Check Machine Controller Manager machine-deployments in the cluster</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> machinedeployment</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   DESIRED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   UP-TO-DATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AVAILABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-machine-deployment</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           10m</span></span></code></pre></div><p>You will notice a new machine-deployment with your given name</p><ul><li>Check Machine Controller Manager machine-sets in the cluster</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> machineset</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                 DESIRED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CURRENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-machine-deployment-5bc6dd7c8f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       10m</span></span></code></pre></div><p>You will notice a new machine-set backing your machine-deployment</p><ul><li>Check Machine Controller Manager machines in the cluster</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> machine</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                       STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-machine-deployment-5bc6dd7c8f-5d24b</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Pending</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   5m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-machine-deployment-5bc6dd7c8f-6mpn4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Pending</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   5m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-machine-deployment-5bc6dd7c8f-dpt2q</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Pending</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   5m</span></span></code></pre></div><p>Now you will notice N (number of replicas specified in the manifest) new machines whose name are prefixed with the machine-deployment object name that you created.</p><ul><li>After a few minutes (~3 minutes for AWS), you would see that new nodes have joined the cluster. You can see this using</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                          STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       VERSION</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip-10-250-20-19.eu-west-1.compute.internal</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     1m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        v1.8.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip-10-250-27-123.eu-west-1.compute.internal</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     1m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        v1.8.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip-10-250-31-80.eu-west-1.compute.internal</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     1m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        v1.8.0</span></span></code></pre></div><p>This shows how new nodes have joined your cluster</p><h2 id="inspect-status-of-machine-deployment" tabindex="-1">Inspect status of machine-deployment <a class="header-anchor" href="#inspect-status-of-machine-deployment" aria-label="Permalink to &quot;Inspect status of machine-deployment&quot;">​</a></h2><p>To inspect the status of any created machine-deployment run the command below,</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> machinedeployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test-machine-deployment</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yaml</span></span></code></pre></div><p>You should get the following output.</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">machine.sapcloud.io/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MachineDeployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    deployment.kubernetes.io/revision</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    kubectl.kubernetes.io/last-applied-configuration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      {&quot;apiVersion&quot;:&quot;machine.sapcloud.io/v1alpha1&quot;,&quot;kind&quot;:&quot;MachineDeployment&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;name&quot;:&quot;test-machine-deployment&quot;,&quot;namespace&quot;:&quot;&quot;},&quot;spec&quot;:{&quot;minReadySeconds&quot;:200,&quot;replicas&quot;:3,&quot;selector&quot;:{&quot;matchLabels&quot;:{&quot;test-label&quot;:&quot;test-label&quot;}},&quot;strategy&quot;:{&quot;rollingUpdate&quot;:{&quot;maxSurge&quot;:1,&quot;maxUnavailable&quot;:1},&quot;type&quot;:&quot;RollingUpdate&quot;},&quot;template&quot;:{&quot;metadata&quot;:{&quot;labels&quot;:{&quot;test-label&quot;:&quot;test-label&quot;}},&quot;spec&quot;:{&quot;class&quot;:{&quot;kind&quot;:&quot;AWSMachineClass&quot;,&quot;name&quot;:&quot;test-aws&quot;}}}}}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  clusterName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  creationTimestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2017-12-27T08:55:56Z</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  generation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  initializers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">test-machine-deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  resourceVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;12634168&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selfLink</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/apis/machine.sapcloud.io/v1alpha1/test-machine-deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  uid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">c0b488f7-eae3-11e7-a6c0-828f843e4186</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  minReadySeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      test-label</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">test-label</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  strategy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    rollingUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      maxSurge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      maxUnavailable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">RollingUpdate</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      creationTimestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        test-label</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">test-label</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">AWSMachineClass</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">test-aws</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  availableReplicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  conditions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">lastTransitionTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2017-12-27T08:57:22Z</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    lastUpdateTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2017-12-27T08:57:22Z</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment has minimum availability.</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    reason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MinimumReplicasAvailable</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;True&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Available</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  readyReplicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  updatedReplicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span></code></pre></div><h2 id="health-monitoring" tabindex="-1">Health monitoring <a class="header-anchor" href="#health-monitoring" aria-label="Permalink to &quot;Health monitoring&quot;">​</a></h2><p>Health monitor is also applied similar to how it&#39;s described for <a href="/docs/other-components/machine-controller-manager/machine_set/">machine-sets</a></p><h2 id="update-your-machines" tabindex="-1">Update your machines <a class="header-anchor" href="#update-your-machines" aria-label="Permalink to &quot;Update your machines&quot;">​</a></h2><p>Let us consider the scenario where you wish to update all nodes of your cluster from t2.xlarge machines to m5.xlarge machines. Assume that your current <em>test-aws</em> has its <strong>spec.machineType: t2.xlarge</strong> and your deployment <em>test-machine-deployment</em> points to this AWSMachineClass.</p><h4 id="inspect-existing-cluster-configuration" tabindex="-1">Inspect existing cluster configuration <a class="header-anchor" href="#inspect-existing-cluster-configuration" aria-label="Permalink to &quot;Inspect existing cluster configuration&quot;">​</a></h4><ul><li>Check Nodes present in the cluster</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                          STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       VERSION</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip-10-250-20-19.eu-west-1.compute.internal</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     1m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        v1.8.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip-10-250-27-123.eu-west-1.compute.internal</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     1m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        v1.8.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip-10-250-31-80.eu-west-1.compute.internal</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     1m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        v1.8.0</span></span></code></pre></div><ul><li>Check Machine Controller Manager machine-sets in the cluster. You will notice one machine-set backing your machine-deployment</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> machineset</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                 DESIRED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CURRENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-machine-deployment-5bc6dd7c8f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       10m</span></span></code></pre></div><ul><li>Login to your cloud provider (AWS). In the VM management console, you will find N VMs created of type t2.xlarge.</li></ul><h4 id="perform-a-rolling-update" tabindex="-1">Perform a rolling update <a class="header-anchor" href="#perform-a-rolling-update" aria-label="Permalink to &quot;Perform a rolling update&quot;">​</a></h4><p>To update this machine-deployment VMs to <code>m5.xlarge</code>, we would do the following:</p><ul><li>Copy your existing aws-machine-class.yaml</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes/machine_classes/aws-machine-class.yaml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes/machine_classes/aws-machine-class-new.yaml</span></span></code></pre></div><ul><li>Modify aws-machine-class-new.yaml, and update its <em>metadata.name: test-aws2</em> and <em>spec.machineType: m5.xlarge</em></li><li>Now create this modified MachineClass</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes/machine_classes/aws-machine-class-new.yaml</span></span></code></pre></div><ul><li>Edit your existing machine-deployment</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> edit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> machinedeployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test-machine-deployment</span></span></code></pre></div><ul><li>Update from <em>spec.template.spec.class.name: test-aws</em> to <em>spec.template.spec.class.name: test-aws2</em></li></ul><h4 id="re-check-cluster-configuration" tabindex="-1">Re-check cluster configuration <a class="header-anchor" href="#re-check-cluster-configuration" aria-label="Permalink to &quot;Re-check cluster configuration&quot;">​</a></h4><p>After a few minutes (~3mins)</p><ul><li>Check nodes present in cluster now. They are different nodes.</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                          STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       VERSION</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip-10-250-11-171.eu-west-1.compute.internal</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     4m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        v1.8.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip-10-250-17-213.eu-west-1.compute.internal</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     5m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        v1.8.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip-10-250-31-81.eu-west-1.compute.internal</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     5m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        v1.8.0</span></span></code></pre></div><ul><li>Check Machine Controller Manager machine-sets in the cluster. You will notice two machine-sets backing your machine-deployment</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> machineset</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                 DESIRED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CURRENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-machine-deployment-5bc6dd7c8f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       1h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-machine-deployment-86ff45cc5</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       20m</span></span></code></pre></div><ul><li>Login to your cloud provider (AWS). In the VM management console, you will find N VMs created of type t2.xlarge in terminated state, and N new VMs of type m5.xlarge in running state.</li></ul><p>This shows how a rolling update of a cluster from nodes with t2.xlarge to m5.xlarge went through.</p><h4 id="more-variants-of-updates" tabindex="-1">More variants of updates <a class="header-anchor" href="#more-variants-of-updates" aria-label="Permalink to &quot;More variants of updates&quot;">​</a></h4><ul><li>The above demonstration was a simple use case. This could be more complex like - updating the system disk image versions/ kubelet versions/ security patches etc.</li><li>You can also play around with the maxSurge and maxUnavailable fields in machine-deployment.yaml</li><li>You can also change the update strategy from rollingupdate to recreate</li></ul><h2 id="undo-an-update" tabindex="-1">Undo an update <a class="header-anchor" href="#undo-an-update" aria-label="Permalink to &quot;Undo an update&quot;">​</a></h2><ul><li>Edit the existing machine-deployment</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> edit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> machinedeployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test-machine-deployment</span></span></code></pre></div><ul><li>Edit the deployment to have this new field of <em>spec.rollbackTo.revision: 0</em> as shown as comments in <code>kubernetes/machine_objects/machine-deployment.yaml</code></li><li>This will undo your update to the previous version.</li></ul><h2 id="pause-an-update" tabindex="-1">Pause an update <a class="header-anchor" href="#pause-an-update" aria-label="Permalink to &quot;Pause an update&quot;">​</a></h2><ul><li>You can also pause the update while update is going on by editing the existing machine-deployment</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> edit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> machinedeployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test-machine-deployment</span></span></code></pre></div><ul><li><p>Edit the deployment to have this new field of <em>spec.paused: true</em> as shown as comments in <code>kubernetes/machine_objects/machine-deployment.yaml</code></p></li><li><p>This will pause the rollingUpdate if it&#39;s in process</p></li><li><p>To resume the update, edit the deployment as mentioned above and remove the field <em>spec.paused: true</em> updated earlier</p></li></ul><h2 id="delete-machine-deployment" tabindex="-1">Delete machine-deployment <a class="header-anchor" href="#delete-machine-deployment" aria-label="Permalink to &quot;Delete machine-deployment&quot;">​</a></h2><ul><li>To delete the VM using the <code>kubernetes/machine_objects/machine-deployment.yaml</code></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> delete</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes/machine_objects/machine-deployment.yaml</span></span></code></pre></div><p>The Machine Controller Manager picks up the manifest and starts to delete the existing VMs by talking to the cloud provider. The nodes should be detached from the cluster in a few minutes (~1min for AWS).</p>`,69)]))}const g=i(t,[["render",l]]);export{c as __pageData,g as default};
