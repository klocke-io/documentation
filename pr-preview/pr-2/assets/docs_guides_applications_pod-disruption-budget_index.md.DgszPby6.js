import{_ as i,c as t,o as a,a2 as o}from"./chunks/framework.B8WFj13S.js";const h=JSON.parse('{"title":"Specifying a Disruption Budget for Kubernetes Controllers","description":"","frontmatter":{"category":"Getting Started","featured":true,"github_repo":"https://github.com/gardener/documentation","github_subdir":"website/documentation/guides/applications","index":10,"level":"beginner","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/guides/applications/pod-disruption-budget.md","to":"pod-disruption-budget.md"},"publishdate":"2022-06-21","scope":"app-developer","title":"Specifying a Disruption Budget for Kubernetes Controllers","prev":false,"next":false},"headers":[],"relativePath":"docs/guides/applications/pod-disruption-budget/index.md","filePath":"docs/guides/applications/pod-disruption-budget.md","lastUpdated":null}'),s={name:"docs/guides/applications/pod-disruption-budget/index.md"};function n(l,e,r,p,d,c){return a(),t("div",null,e[0]||(e[0]=[o(`<h1 id="specifying-a-disruption-budget-for-kubernetes-controllers" tabindex="-1">Specifying a Disruption Budget for Kubernetes Controllers <a class="header-anchor" href="#specifying-a-disruption-budget-for-kubernetes-controllers" aria-label="Permalink to &quot;Specifying a Disruption Budget for Kubernetes Controllers&quot;">​</a></h1><h2 id="introduction-of-disruptions" tabindex="-1">Introduction of Disruptions <a class="header-anchor" href="#introduction-of-disruptions" aria-label="Permalink to &quot;Introduction of Disruptions&quot;">​</a></h2><p>We need to understand that some kind of voluntary disruptions can happen to pods. For example, they can be caused by cluster administrators who want to perform automated cluster actions, like upgrading and autoscaling clusters. Typical application owner actions include:</p><ul><li>deleting the deployment or other controller that manages the pod</li><li>updating a deployment&#39;s pod template causing a restart</li><li>directly deleting a pod (e.g., by accident)</li></ul><h2 id="setup-pod-disruption-budgets" tabindex="-1">Setup Pod Disruption Budgets <a class="header-anchor" href="#setup-pod-disruption-budgets" aria-label="Permalink to &quot;Setup Pod Disruption Budgets&quot;">​</a></h2><p>Kubernetes offers a feature called PodDisruptionBudget (PDB) for each application. A PDB limits the number of pods of a replicated application that are down simultaneously from voluntary disruptions.</p><p>The most common use case is when you want to protect an application specified by one of the built-in Kubernetes controllers:</p><ul><li>Deployment</li><li>ReplicationController</li><li>ReplicaSet</li><li>StatefulSet</li></ul><p>A PodDisruptionBudget has three fields:</p><ul><li>A label selector <code>.spec.selector</code> to specify the set of pods to which it applies.</li><li><code>.spec.minAvailable</code> which is a description of the number of pods from that set that must still be available after the eviction, even in the absence of the evicted pod. minAvailable can be either an absolute number or a percentage.</li><li><code>.spec.maxUnavailable</code> which is a description of the number of pods from that set that can be unavailable after the eviction. It can be either an absolute number or a percentage.</li></ul><h2 id="cluster-upgrade-or-node-deletion-failed-due-to-pdb-violation" tabindex="-1">Cluster Upgrade or Node Deletion Failed due to PDB Violation <a class="header-anchor" href="#cluster-upgrade-or-node-deletion-failed-due-to-pdb-violation" aria-label="Permalink to &quot;Cluster Upgrade or Node Deletion Failed due to PDB Violation&quot;">​</a></h2><p>Misconfiguration of the PDB could block the cluster upgrade or node deletion processes. There are two main cases that can cause a misconfiguration.</p><h3 id="case-1-the-replica-of-kubernetes-controllers-is-1" tabindex="-1">Case 1: The replica of Kubernetes controllers is 1 <a class="header-anchor" href="#case-1-the-replica-of-kubernetes-controllers-is-1" aria-label="Permalink to &quot;Case 1: The replica of Kubernetes controllers is 1&quot;">​</a></h3><ul><li><p>Only 1 replica is running: there is no <code>replicaCount</code> setup or <code>replicaCount</code> for the Kubernetes controllers is set to 1</p></li><li><p>PDB configuration</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    minAvailable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span></code></pre></div></li><li><p>To fix this PDB misconfiguration, you need to change the value of <code>replicaCount</code> for the Kubernetes controllers to a number greater than 1</p></li></ul><h3 id="case-2-hpa-configuration-violates-pdb" tabindex="-1">Case 2: HPA configuration violates PDB <a class="header-anchor" href="#case-2-hpa-configuration-violates-pdb" aria-label="Permalink to &quot;Case 2: HPA configuration violates PDB&quot;">​</a></h3><p>In Kubernetes, a HorizontalPodAutoscaler automatically updates a workload resource (such as a Deployment or StatefulSet), with the aim of automatically scaling the workload to match demand. The HorizontalPodAutoscaler manages the replicas field of the Kubernetes controllers.</p><ul><li><p>There is no <code>replicaCount</code> setup or <code>replicaCount</code> for the Kubernetes controllers is set to 1</p></li><li><p>PDB configuration</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    minAvailable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span></code></pre></div></li><li><p>HPA configuration</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    minReplicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span></code></pre></div></li><li><p>To fix this PDB misconfiguration, you need to change the value of HPA <code>minReplicas</code> to be greater than 1</p></li></ul><h2 id="related-links" tabindex="-1">Related Links <a class="header-anchor" href="#related-links" aria-label="Permalink to &quot;Related Links&quot;">​</a></h2><ul><li><a href="https://kubernetes.io/docs/tasks/run-application/configure-pdb/" target="_blank" rel="noreferrer">Specifying a Disruption Budget for Your Application</a></li><li><a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank" rel="noreferrer">Horizontal Pod Autoscaling</a></li></ul>`,19)]))}const g=i(s,[["render",n]]);export{h as __pageData,g as default};
