import{_ as i,c as a,o as t,a2 as e}from"./chunks/framework.B8WFj13S.js";const c=JSON.parse('{"title":"Container Image Not Pulled","description":"Wrong Container Image or Invalid Registry Permissions","frontmatter":{"category":"Fails","description":"Wrong Container Image or Invalid Registry Permissions","github_repo":"https://github.com/gardener/documentation","github_subdir":"website/documentation/guides/applications","last_reviewed":"22.06.2018","level":"beginner","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/guides/applications/missing-registry-permission.md","to":"missing-registry-permission.md"},"reviewer":"Tieyan Fu","scope":"app-developer","title":"Container Image Not Pulled","prev":false,"next":false},"headers":[],"relativePath":"docs/guides/applications/missing-registry-permission/index.md","filePath":"docs/guides/applications/missing-registry-permission.md","lastUpdated":null}'),n={name:"docs/guides/applications/missing-registry-permission/index.md"};function l(p,s,h,r,k,o){return t(),a("div",null,s[0]||(s[0]=[e(`<h1 id="container-image-not-pulled" tabindex="-1">Container Image Not Pulled <a class="header-anchor" href="#container-image-not-pulled" aria-label="Permalink to &quot;Container Image Not Pulled&quot;">​</a></h1><h2 id="problem" tabindex="-1">Problem <a class="header-anchor" href="#problem" aria-label="Permalink to &quot;Problem&quot;">​</a></h2><p>Two of the most common causes of this problems are specifying the wrong container image or trying to use private images without providing registry credentials.</p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>There is no observable difference in pod status between a missing image and incorrect registry permissions. In either case, Kubernetes will report an <code>ErrImagePull</code> status for the pods. For this reason, this article deals with both scenarios.</p></div><h2 id="example" tabindex="-1">Example <a class="header-anchor" href="#example" aria-label="Permalink to &quot;Example&quot;">​</a></h2><p>Let&#39;s see an example. We&#39;ll create a pod named <em>fail</em>, referencing a non-existent Docker image:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tty</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --image=tutum/curl:1.123456</span></span></code></pre></div><p>The command doesn&#39;t return and you can terminate the process with <code>Ctrl+C</code>.</p><h2 id="error-analysis" tabindex="-1">Error Analysis <a class="header-anchor" href="#error-analysis" aria-label="Permalink to &quot;Error Analysis&quot;">​</a></h2><p>We can then inspect our pods and see that we have one pod with a status of <strong>ErrImagePull</strong> or <strong>ImagePullBackOff</strong>.</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (minikube) kubectl get pods</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         RESTARTS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">client-5b65b6c866-cs4ch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          1m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fail-6667d7685d-7v6w8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       ErrImagePull</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">invali</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vuejs-578574b75f-5x98z</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          1d</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (minikube)</span></span></code></pre></div><p>For some additional information, we can <code>describe</code> the failing pod.</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fail-6667d7685d-7v6w8</span></span></code></pre></div><p>As you can see in the events section, your image can&#39;t be pulled:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   fail-6667d7685d-7v6w8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Namespace:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Node:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   minikube/192.168.64.10</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Time:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Wed,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2017</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10:01:59</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0100</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Labels:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   pod-template-hash=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2223832418</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    run</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">fail</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Annotations:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes.io/created-by={&quot;kind&quot;:&quot;SerializedReference&quot;,&quot;apiVersion&quot;:&quot;v1&quot;,&quot;reference&quot;:{&quot;kind&quot;:&quot;ReplicaSet&quot;,&quot;namespace&quot;:&quot;default&quot;,&quot;name&quot;:&quot;fail-6667d7685d&quot;,&quot;uid&quot;:&quot;cc4ccb3f-cf63-11e7-afca-4a7a1fa05b3f&quot;,&quot;a...</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Events:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  FirstSeen	LastSeen	Count	From			SubObjectPath		Type		Reason			Message</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ---------	--------	-----	----			-------------		--------	------			-------</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1m		1m		1	default-scheduler				Normal		Scheduled		Successfully assigned fail-6667d7685d-7v6w8 to minikube</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1m		1m		1	kubelet, minikube				Normal		SuccessfulMountVolume	MountVolume.SetUp succeeded for volume &quot;default-token-9fr6r&quot; </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1m		6s		4	kubelet, minikube	spec.containers{fail}	Normal		Pulling			pulling image &quot;tutum/curl:1.123456&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1m		5s		4	kubelet, minikube	spec.containers{fail}	Warning		Failed			Failed to pull image &quot;tutum/curl:1.123456&quot;: rpc error: code = Unknown desc = Error response from daemon: manifest for tutum/curl:1.123456 not found</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1m		&lt;invalid&gt;	10	kubelet, minikube				Warning		FailedSync		Error syncing pod</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1m		&lt;invalid&gt;	6	kubelet, minikube	spec.containers{fail}	Normal		BackOff			Back-off pulling image &quot;tutum/curl:1.123456&quot;</span></span></code></pre></div><p><strong>Why couldn&#39;t Kubernetes pull the image?</strong> There are three primary candidates besides network connectivity issues:</p><ul><li>The image tag is incorrect</li><li>The image doesn&#39;t exist</li><li>Kubernetes doesn&#39;t have permissions to pull that image</li></ul><p>If you don&#39;t notice a typo in your image tag, then it&#39;s time to test using your local machine. I usually start by running <strong>docker pull on my local development machine</strong> with the exact same image tag. In this case, I would run <code>docker pull tutum/curl:1.123456</code>.</p><p>If this succeeds, then it probably means that Kubernetes doesn&#39;t have the correct permissions to pull that image.</p><p>Add the docker registry user/pwd to your cluster:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-registry</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dockersecret</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --docker-server=https://index.docker.io/v1/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --docker-username=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">username</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --docker-password=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">password</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --docker-email=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">email</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>If the exact image tag fails, then I will test without an explicit image tag:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tutum/curl</span></span></code></pre></div><p>This command will attempt to pull the latest tag. If this succeeds, then that means the originally specified tag doesn&#39;t exist. Go to the Docker registry and check which tags are available for this image.</p><p>If <code>docker pull tutum/curl</code> (without an exact tag) fails, then we have a bigger problem - that image does not exist at all in our image registry.</p>`,25)]))}const g=i(n,[["render",l]]);export{c as __pageData,g as default};
