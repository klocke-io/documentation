import{_ as t,c as a,o as r,a2 as o}from"./chunks/framework.B8WFj13S.js";const h=JSON.parse('{"title":"Backup and Restore","description":"Understand the etcd backup and restore capabilities of Gardener","frontmatter":{"categories":["Users"],"description":"Understand the etcd backup and restore capabilities of Gardener","github_repo":"https://github.com/gardener/gardener","github_subdir":"docs/concepts","params":{"github_branch":"master"},"path_base_for_github_subdir":{"from":"content/docs/gardener/concepts/backup-restore.md","to":"backup-restore.md"},"title":"Backup and Restore","prev":false,"next":false},"headers":[],"relativePath":"docs/gardener/concepts/backup-restore/index.md","filePath":"docs/gardener/concepts/backup-restore.md","lastUpdated":null}'),s={name:"docs/gardener/concepts/backup-restore/index.md"};function i(n,e,c,d,l,u){return r(),a("div",null,e[0]||(e[0]=[o('<h1 id="backup-and-restore" tabindex="-1">Backup and Restore <a class="header-anchor" href="#backup-and-restore" aria-label="Permalink to &quot;Backup and Restore&quot;">​</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>Kubernetes uses <a href="https://etcd.io/" target="_blank" rel="noreferrer">etcd</a> as the key-value store for its resource definitions. Gardener supports the backup and restore of etcd. It is the responsibility of the shoot owners to backup the workload data.</p><p>Gardener uses an <a href="https://github.com/gardener/etcd-backup-restore" target="_blank" rel="noreferrer">etcd-backup-restore</a> component to backup the etcd backing the Shoot cluster regularly and restore it in case of disaster. It is deployed as sidecar via <a href="https://github.com/gardener/etcd-druid" target="_blank" rel="noreferrer">etcd-druid</a>. This doc mainly focuses on the backup and restore configuration used by Gardener when deploying these components. For more details on the design and internal implementation details, please refer to <a href="https://github.com/gardener/gardener/blob/master/docs/proposals/06-etcd-druid.md" target="_blank" rel="noreferrer">GEP-06</a> and the documentation on individual repositories.</p><h2 id="bucket-provisioning" tabindex="-1">Bucket Provisioning <a class="header-anchor" href="#bucket-provisioning" aria-label="Permalink to &quot;Bucket Provisioning&quot;">​</a></h2><p>Refer to the <a href="/documentation/pr-preview/pr-2/docs/gardener/extensions/resources/backupbucket/">backup bucket extension document</a> to find out details about configuring the backup bucket.</p><h2 id="backup-policy" tabindex="-1">Backup Policy <a class="header-anchor" href="#backup-policy" aria-label="Permalink to &quot;Backup Policy&quot;">​</a></h2><p>etcd-backup-restore supports full snapshot and delta snapshots over full snapshot. In Gardener, this configuration is currently hard-coded to the following parameters:</p><ul><li>Full Snapshot schedule: <ul><li>Daily, <code>24hr</code> interval.</li><li>For each Shoot, the schedule time in a day is randomized based on the configured Shoot maintenance window.</li></ul></li><li>Delta Snapshot schedule: <ul><li>At <code>5min</code> interval.</li><li>If aggregated events size since last snapshot goes beyond <code>100Mib</code>.</li></ul></li><li>Backup History / Garbage backup deletion policy: <ul><li>Gardener configures backup restore to have <code>Exponential</code> garbage collection policy.</li><li>As per policy, the following backups are retained: <ul><li>All full backups and delta backups for the previous hour.</li><li>Latest full snapshot of each previous hour for the day.</li><li>Latest full snapshot of each previous day for 7 days.</li><li>Latest full snapshot of the previous 4 weeks.</li></ul></li><li>Garbage Collection is configured at <code>12hr</code> interval.</li></ul></li><li>Listing: <ul><li>Gardener doesn&#39;t have any API to list out the backups.</li><li>To find the backups list, an admin can checkout the <code>BackupEntry</code> resource associated with the Shoot which holds the bucket and prefix details on the object store.</li></ul></li></ul><h2 id="restoration" tabindex="-1">Restoration <a class="header-anchor" href="#restoration" aria-label="Permalink to &quot;Restoration&quot;">​</a></h2><p>The restoration process of etcd is automated through the etcd-backup-restore component from the latest snapshot. Gardener doesn&#39;t support Point-In-Time-Recovery (PITR) of etcd. In case of an etcd disaster, the etcd is recovered from the latest backup automatically. For further details, please refer the <a href="https://github.com/gardener/etcd-backup-restore/blob/master/docs/proposals/restoration.md" target="_blank" rel="noreferrer">Restoration</a> topic. Post restoration of etcd, the Shoot reconciliation loop brings the cluster back to its previous state.</p><p>Again, the Shoot owner is responsible for maintaining the backup/restore of his workload. Gardener only takes care of the cluster&#39;s etcd.</p>',12)]))}const b=t(s,[["render",i]]);export{h as __pageData,b as default};
